<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>Python 3.11.0 正式发布！主要新特性一览 | FunnySaltyFish's Blog</title><meta name="author" content="FunnySaltyFish"><meta name="copyright" content="FunnySaltyFish"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="去年（2021）的 10 月份，Python 发布了 3.10.0 正式版，我也在第一时间做了介绍（相关文章）；一年后的几天前，Python 3.11.0 正式版也亮相了。目前的下载链接：https:&amp;#x2F;&amp;#x2F;www.python.org&amp;#x2F;downloads&amp;#x2F;release&amp;#x2F;python-3110&amp;#x2F;下面就"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://blog.funnysaltyfish.fun/2023/01/08/python-311-taste/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?916327b5895b588b069297cd54d0b539";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#121212","position":"bottom-left"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Python 3.11.0 正式发布！主要新特性一览',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-01-08 13:31:14'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5597677676259249" crossorigin="anonymous"></script><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="FunnySaltyFish's Blog" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://web.funnysaltyfish.fun/temp_img/avator.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">41</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">12</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">4</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/images/bg_python.jpeg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">FunnySaltyFish's Blog</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Python 3.11.0 正式发布！主要新特性一览</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-01-08T05:30:44.000Z" title="发表于 2023-01-08 13:30:44">2023-01-08</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-01-08T05:31:14.702Z" title="更新于 2023-01-08 13:31:14">2023-01-08</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Python 3.11.0 正式发布！主要新特性一览"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>去年（2021）的 10 月份，Python 发布了 3.10.0 正式版，我也在第一时间做了介绍（<a target="_blank" rel="noopener" href="https://juejin.cn/post/7015590447745613854">相关文章</a>）；一年后的几天前，Python 3.11.0 正式版也亮相了。目前的下载链接：<a target="_blank" rel="noopener" href="https://www.python.org/downloads/release/python-3110/">https://www.python.org/downloads/release/python-3110/</a><br>下面就让我们看一下主要的新特性吧。</p>
<h2 id="快"><a href="#快" class="headerlink" title="快"></a>快</h2><p>3.11 带来的最直观变化就是，Python 更快了。官方的说法是能带来 <strong>10%~60%</strong> 的提速，在基准测试上平均达到了 <strong>1.22x</strong>。更细致的介绍请参见 <a target="_blank" rel="noopener" href="https://docs.python.org/3.11/whatsnew/3.11.html#faster-cpython">What’s New In Python 3.11 — Python 3.11.0 documentation</a>。</p>
<p>下面摘录其中部分提升</p>
<table>
<thead>
<tr>
<th>操作</th>
<th>形式</th>
<th>限定</th>
<th>最大加速</th>
<th>贡献者(们)</th>
</tr>
</thead>
<tbody><tr>
<td>二元运算</td>
<td><code>x+x; x*x; x-x;</code></td>
<td>Binary add, multiply and subtract for common types such as <code>int</code>, <code>float</code>, and <code>str</code> take custom fast paths for their underlying types.</td>
<td>10%</td>
<td>Mark Shannon, Dong-hee Na, Brandt Bucher, Dennis Sweeney</td>
</tr>
<tr>
<td>下标读取</td>
<td><code>a[i]</code></td>
<td>Subscripting container types such as <code>list</code>, <code>tuple</code> and <code>dict</code> directly index the underlying data structures.Subscripting custom <code>__getitem__</code> is also inlined similar to <a target="_blank" rel="noopener" href="https://docs.python.org/3.11/whatsnew/3.11.html#inline-calls">Inlined Python function calls</a>.</td>
<td>10-25%</td>
<td>Irit Katriel, Mark Shannon</td>
</tr>
<tr>
<td>下标写入</td>
<td><code>a[i] = z</code></td>
<td>Similar to subscripting specialization above.</td>
<td>10-25%</td>
<td>Dennis Sweeney</td>
</tr>
<tr>
<td>函数调用</td>
<td><code>f(arg)</code> <code>C(arg)</code></td>
<td>Calls to common builtin (C) functions and types such as <code>len</code> and <code>str</code> directly call their underlying C version. This avoids going through the internal calling convention.</td>
<td>20%</td>
<td>Mark Shannon, Ken Jin</td>
</tr>
<tr>
<td>加载全局变量</td>
<td><code>print</code> <code>len</code></td>
<td>The object’s index in the globals&#x2F;builtins namespace is cached. Loading globals and builtins require zero namespace lookups.</td>
<td><a target="_blank" rel="noopener" href="https://docs.python.org/3.11/whatsnew/3.11.html#id4">1</a></td>
<td>Mark Shannon</td>
</tr>
<tr>
<td>加载属性</td>
<td><code>o.attr</code></td>
<td>Similar to loading global variables. The attribute’s index inside the class&#x2F;object’s namespace is cached. In most cases, attribute loading will require zero namespace lookups.</td>
<td><a target="_blank" rel="noopener" href="https://docs.python.org/3.11/whatsnew/3.11.html#id5">2</a></td>
<td>Mark Shannon</td>
</tr>
<tr>
<td>加载方法调用</td>
<td><code>o.meth()</code></td>
<td>The actual address of the method is cached. Method loading now has no namespace lookups – even for classes with long inheritance chains.</td>
<td>10-20%</td>
<td>Ken Jin, Mark Shannon</td>
</tr>
<tr>
<td>属性赋值</td>
<td><code>o.attr = z</code></td>
<td>Similar to load attribute optimization.</td>
<td>2% in pyperformance</td>
<td>Mark Shannon</td>
</tr>
<tr>
<td>序列拆包</td>
<td><code>*seq</code></td>
<td>Specialized for common containers such as <code>list</code> and <code>tuple</code>. Avoids internal calling convention.</td>
<td>8%</td>
<td>Brandt Bucher</td>
</tr>
</tbody></table>
<ul>
<li><a target="_blank" rel="noopener" href="https://docs.python.org/3.11/whatsnew/3.11.html#id2">1</a>：类似的优化已在 Python 3.8 出现， 3.11 能针对更多特定情况、减少开支.</li>
<li><a target="_blank" rel="noopener" href="https://docs.python.org/3.11/whatsnew/3.11.html#id3">2</a>：类似的优化已在 Python 3.8 出现， 3.11 能针对更多特定情况。 此外，所有对属性的加载都应由 <a target="_blank" rel="noopener" href="https://bugs.python.org/issue?@action=redirect&bpo=45947">bpo-45947</a> 得以加速.</li>
</ul>
<p>秉持着试试的思想，我自己也写了段简单的代码进行比较，三种不同的操作各跑 5 组，每组多次，最后平均再输出。代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;author: FunnySaltyFish，可在 Github 和 掘金 搜此名找到我&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">from</span> timeit <span class="keyword">import</span> repeat</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sum_test</span>(<span class="params">n</span>):</span><br><span class="line">    s = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        s += i</span><br><span class="line">    <span class="keyword">return</span> s</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">mean</span>(<span class="params">arr</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">sum</span>(arr) / <span class="built_in">len</span>(arr)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 看一个列表生成器的执行时间，执行10000次：</span></span><br><span class="line">t1 = repeat(<span class="string">&#x27;[i for i in range(100) if i%2==0]&#x27;</span>, number=<span class="number">10000</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;列表生成器 平均耗时 <span class="subst">&#123;mean(t1):&gt;<span class="number">8.3</span>f&#125;</span>s&quot;</span>)</span><br><span class="line"><span class="comment"># 执行函数的时间，执行10000次：</span></span><br><span class="line">t2 = repeat(<span class="string">&#x27;sum_test(100)&#x27;</span>, number=<span class="number">10000</span>, <span class="built_in">globals</span>=<span class="built_in">globals</span>())</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;函数 平均耗时 <span class="subst">&#123;mean(t2):&gt;<span class="number">14.3</span>f&#125;</span>s&quot;</span>)</span><br><span class="line"><span class="comment"># 执行字典生成器的时间，执行10000次：</span></span><br><span class="line">t3 = repeat(<span class="string">&#x27;&#123;i:i for i in range(100) if i%2==0&#125;&#x27;</span>, number=<span class="number">10000</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;字典生成器 平均耗时 <span class="subst">&#123;mean(t3):&gt;<span class="number">8.3</span>f&#125;</span>s&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>在 <code>Python 3.10.4</code> 运行输出如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">列表生成器 平均耗时    3.470s</span><br><span class="line">函数 平均耗时         2.704s</span><br><span class="line">字典生成器 平均耗时    4.844s</span><br></pre></td></tr></table></figure>

<p>在 <code>Python 3.11.0</code> 结果如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">列表生成器 平均耗时    4.367s</span><br><span class="line">函数 平均耗时         2.545s</span><br><span class="line">字典生成器 平均耗时    4.969s</span><br></pre></td></tr></table></figure>

<p>结果令我很意外，除了函数调用那组，py 311 在其他两项上反而慢于 310。即使我重新跑了几次效果都差不多。可能是我打开的姿势不对？如果您读到这里发现了问题或者想自己试试，也欢迎在评论区一起讨论。</p>
<h2 id="更友好的错误提示"><a href="#更友好的错误提示" class="headerlink" title="更友好的错误提示"></a>更友好的错误提示</h2><blockquote>
<p><a target="_blank" rel="noopener" href="https://peps.python.org/pep-0657/">PEP 657 – Include Fine Grained Error Locations in Tracebacks </a>  </p>
</blockquote>
<p>Py 310 也有这方面的优化，311 则更进一步。 </p>
<h3 id="动机"><a href="#动机" class="headerlink" title="动机"></a>动机</h3><p>比如说下面的代码:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">x[<span class="string">&#x27;a&#x27;</span>][<span class="string">&#x27;b&#x27;</span>][<span class="string">&#x27;c&#x27;</span>][<span class="string">&#x27;d&#x27;</span>] = <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>如果上面一长串中，有任何一个是 <code>None</code>，报错就是这个样子：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;test.py&quot;</span>, line <span class="number">2</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    x[<span class="string">&#x27;a&#x27;</span>][<span class="string">&#x27;b&#x27;</span>][<span class="string">&#x27;c&#x27;</span>][<span class="string">&#x27;d&#x27;</span>] = <span class="number">1</span></span><br><span class="line">TypeError: <span class="string">&#x27;NoneType&#x27;</span> <span class="built_in">object</span> <span class="keyword">is</span> <span class="keyword">not</span> subscriptable</span><br></pre></td></tr></table></figure>

<p>从这个报错很难看出到底哪里是 <code>None</code> ，通常得 debug 或者 print 才知道。</p>
<p>所以在 311 里，报错进化成了这样：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;test.py&quot;</span>, line <span class="number">2</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    x[<span class="string">&#x27;a&#x27;</span>][<span class="string">&#x27;b&#x27;</span>][<span class="string">&#x27;c&#x27;</span>][<span class="string">&#x27;d&#x27;</span>] = <span class="number">1</span></span><br><span class="line">    ~~~~~~~~~~~^^^^^</span><br><span class="line">TypeError: <span class="string">&#x27;NoneType&#x27;</span> <span class="built_in">object</span> <span class="keyword">is</span> <span class="keyword">not</span> subscriptable</span><br></pre></td></tr></table></figure>

<p>这样就能直观地知道，<code>[&#39;c&#39;]</code>这里出问题了。<br>更多例子如下所示：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;test.py&quot;</span>, line <span class="number">14</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    lel3(x)</span><br><span class="line">    ^^^^^^^</span><br><span class="line">    </span><br><span class="line">  File <span class="string">&quot;test.py&quot;</span>, line <span class="number">12</span>, <span class="keyword">in</span> lel3</span><br><span class="line">    <span class="keyword">return</span> lel2(x) / <span class="number">23</span></span><br><span class="line">           ^^^^^^^</span><br><span class="line">           </span><br><span class="line">  File <span class="string">&quot;test.py&quot;</span>, line <span class="number">9</span>, <span class="keyword">in</span> lel2</span><br><span class="line">    <span class="keyword">return</span> <span class="number">25</span> + lel(x) + lel(x)</span><br><span class="line">                ^^^^^^</span><br><span class="line">                </span><br><span class="line">  File <span class="string">&quot;test.py&quot;</span>, line <span class="number">6</span>, <span class="keyword">in</span> lel</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span> + foo(a,b,c=x[<span class="string">&#x27;z&#x27;</span>][<span class="string">&#x27;x&#x27;</span>][<span class="string">&#x27;y&#x27;</span>][<span class="string">&#x27;z&#x27;</span>][<span class="string">&#x27;y&#x27;</span>], d=e)</span><br><span class="line">                         ~~~~~~~~~~~~~~~~^^^^^</span><br><span class="line">TypeError: <span class="string">&#x27;NoneType&#x27;</span> <span class="built_in">object</span> <span class="keyword">is</span> <span class="keyword">not</span> subscriptable</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">foo</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="number">1</span> + <span class="number">1</span>/<span class="number">0</span> + <span class="number">2</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bar</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="number">1</span> + foo(x) + foo(x)</span><br><span class="line">    <span class="keyword">except</span> Exception:</span><br><span class="line">        <span class="keyword">raise</span></span><br><span class="line">bar(bar(bar(<span class="number">2</span>)))</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;test.py&quot;</span>, line <span class="number">10</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    bar(bar(bar(<span class="number">2</span>)))</span><br><span class="line">            ^^^^^^</span><br><span class="line">  File <span class="string">&quot;test.py&quot;</span>, line <span class="number">6</span>, <span class="keyword">in</span> bar</span><br><span class="line">    <span class="number">1</span> + foo(x) + foo(x)</span><br><span class="line">        ^^^^^^</span><br><span class="line">  File <span class="string">&quot;test.py&quot;</span>, line <span class="number">2</span>, <span class="keyword">in</span> foo</span><br><span class="line">    <span class="number">1</span> + <span class="number">1</span>/<span class="number">0</span> + <span class="number">2</span></span><br><span class="line">        ~^~</span><br><span class="line">ZeroDivisionError: division by zero</span><br></pre></td></tr></table></figure>

<h2 id="异常组与-except"><a href="#异常组与-except" class="headerlink" title="异常组与 except *"></a>异常组与 except *</h2><blockquote>
<p><a target="_blank" rel="noopener" href="https://peps.python.org/pep-0654/">PEP 654 – Exception Groups and except* | peps.python.org</a></p>
</blockquote>
<h3 id="动机-1"><a href="#动机-1" class="headerlink" title="动机"></a>动机</h3><ul>
<li><strong>并发错误</strong>：很多异步任务的各种框架允许用户同时进行多个任务，并将结果聚合后一起返回，这时进行异常处理就比较麻烦</li>
<li><strong>在复杂计算中抛出的多个错误</strong></li>
</ul>
<p>pep 中列出了几种情况，总的来说很多都围绕“<strong>同时有多个错误发生，且每一个都需要处理</strong>”的情况。为了更好解决这个问题， 311 提出了异常组</p>
<h3 id="ExceptionGroup"><a href="#ExceptionGroup" class="headerlink" title="ExceptionGroup"></a>ExceptionGroup</h3><p>此 pep 提出了两个新的类： <code>BaseExceptionGroup(BaseException)</code> 和 <code>ExceptionGroup(BaseExceptionGroup, Exception)</code>. 它们可以被赋给<code>Exception.__cause__</code> 、 <code>Exception.__context__</code>，并且可以通过<code>raise ExceptionGroup(...)</code> + <code>try: ... except ExceptionGroup: ...</code> 或 <code>raise BaseExceptionGroup(...)</code> + <code>try: ... except BaseExceptionGroup: ...</code> 抛出和捕获。<br>二者的构造参数均接受俩参数：</p>
<ul>
<li><code>message</code>：消息</li>
<li><code>exceptions</code>：错误列表<br>如： <code>ExceptionGroup(&#39;issues&#39;, [ValueError(&#39;bad value&#39;), TypeError(&#39;bad type&#39;)])</code></li>
</ul>
<p>区别在于，<code>ExceptionGroup</code> 只能包裹 <code>Exception</code> 的子类 ，而 <code>BaseExceptionGroup</code> 能包裹任意 <code>BaseException</code> 的子类。 为行文方便，后文里的“异常组”将代指二者之一。 </p>
<p>因为异常组可以嵌套，所以它能形成一个树形结构。方法 <code>BaseExceptionGroup.subgroup(condition)</code> 能帮我们获取到满足条件的的子异常组，它的整体结构和原始异常组相同。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>eg = ExceptionGroup(</span><br><span class="line"><span class="meta">... </span>    <span class="string">&quot;one&quot;</span>,</span><br><span class="line"><span class="meta">... </span>    [</span><br><span class="line"><span class="meta">... </span>        TypeError(<span class="number">1</span>),</span><br><span class="line"><span class="meta">... </span>        ExceptionGroup(</span><br><span class="line"><span class="meta">... </span>            <span class="string">&quot;two&quot;</span>,</span><br><span class="line"><span class="meta">... </span>             [TypeError(<span class="number">2</span>), ValueError(<span class="number">3</span>)]</span><br><span class="line"><span class="meta">... </span>        ),</span><br><span class="line"><span class="meta">... </span>        ExceptionGroup(</span><br><span class="line"><span class="meta">... </span>             <span class="string">&quot;three&quot;</span>,</span><br><span class="line"><span class="meta">... </span>              [OSError(<span class="number">4</span>)]</span><br><span class="line"><span class="meta">... </span>        )</span><br><span class="line"><span class="meta">... </span>    ]</span><br><span class="line"><span class="meta">... </span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> traceback</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>traceback.print_exception(eg)</span><br><span class="line">  | ExceptionGroup: one (<span class="number">3</span> sub-exceptions)</span><br><span class="line">  +-+---------------- <span class="number">1</span> ----------------</span><br><span class="line">    | TypeError: <span class="number">1</span></span><br><span class="line">    +---------------- <span class="number">2</span> ----------------</span><br><span class="line">    | ExceptionGroup: two (<span class="number">2</span> sub-exceptions)</span><br><span class="line">    +-+---------------- <span class="number">1</span> ----------------</span><br><span class="line">      | TypeError: <span class="number">2</span></span><br><span class="line">      +---------------- <span class="number">2</span> ----------------</span><br><span class="line">      | ValueError: <span class="number">3</span></span><br><span class="line">      +------------------------------------</span><br><span class="line">    +---------------- <span class="number">3</span> ----------------</span><br><span class="line">    | ExceptionGroup: three (<span class="number">1</span> sub-exception)</span><br><span class="line">    +-+---------------- <span class="number">1</span> ----------------</span><br><span class="line">      | OSError: <span class="number">4</span></span><br><span class="line">      +------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>type_errors = eg.subgroup(<span class="keyword">lambda</span> e: <span class="built_in">isinstance</span>(e, TypeError))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>traceback.print_exception(type_errors)</span><br><span class="line">  | ExceptionGroup: one (<span class="number">2</span> sub-exceptions)</span><br><span class="line">  +-+---------------- <span class="number">1</span> ----------------</span><br><span class="line">    | TypeError: <span class="number">1</span></span><br><span class="line">    +---------------- <span class="number">2</span> ----------------</span><br><span class="line">    | ExceptionGroup: two (<span class="number">1</span> sub-exception)</span><br><span class="line">    +-+---------------- <span class="number">1</span> ----------------</span><br><span class="line">      | TypeError: <span class="number">2</span></span><br><span class="line">      +------------------------------------</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>

<p>如果 <code>subgroup</code>啥也没匹配到，它会返回<code>None</code>；如果你想把匹配的和没匹配的分开，则可以用<code>spilt</code>方法</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>type_errors, other_errors = eg.split(<span class="keyword">lambda</span> e: <span class="built_in">isinstance</span>(e, TypeError))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>traceback.print_exception(type_errors)</span><br><span class="line">  | ExceptionGroup: one (<span class="number">2</span> sub-exceptions)</span><br><span class="line">  +-+---------------- <span class="number">1</span> ----------------</span><br><span class="line">    | TypeError: <span class="number">1</span></span><br><span class="line">    +---------------- <span class="number">2</span> ----------------</span><br><span class="line">    | ExceptionGroup: two (<span class="number">1</span> sub-exception)</span><br><span class="line">    +-+---------------- <span class="number">1</span> ----------------</span><br><span class="line">      | TypeError: <span class="number">2</span></span><br><span class="line">      +------------------------------------</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>traceback.print_exception(other_errors)</span><br><span class="line">  | ExceptionGroup: one (<span class="number">2</span> sub-exceptions)</span><br><span class="line">  +-+---------------- <span class="number">1</span> ----------------</span><br><span class="line">    | ExceptionGroup: two (<span class="number">1</span> sub-exception)</span><br><span class="line">    +-+---------------- <span class="number">1</span> ----------------</span><br><span class="line">      | ValueError: <span class="number">3</span></span><br><span class="line">      +------------------------------------</span><br><span class="line">    +---------------- <span class="number">2</span> ----------------</span><br><span class="line">    | ExceptionGroup: three (<span class="number">1</span> sub-exception)</span><br><span class="line">    +-+---------------- <span class="number">1</span> ----------------</span><br><span class="line">      | OSError: <span class="number">4</span></span><br><span class="line">      +------------------------------------</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>

<h3 id="exept"><a href="#exept" class="headerlink" title="exept *"></a>exept *</h3><p>为了更好处理异常组，新的语法<code>except*</code>就诞生了。它可以匹配异常组的一个或多个异常，并且**将其他未匹配的继续传递给其他<code>except*</code>**。示例代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    ...</span><br><span class="line"><span class="keyword">except</span>* SpamError:</span><br><span class="line">    ...</span><br><span class="line"><span class="keyword">except</span>* FooError <span class="keyword">as</span> e:</span><br><span class="line">    ...</span><br><span class="line"><span class="keyword">except</span>* (BarError, BazError) <span class="keyword">as</span> e:</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>
<p>对于上面的例子，假设产生异常的代码为<code>ubhandled = ExceptionGroup(&#39;msg&#39;, [FooError(1), FooError(2), BazError()])</code>。则 <code>except*</code> 就是不断对 <code>unhandled</code> 进行 <code>spilt</code>，并将未匹配到的结果传下去。对上面的例子：</p>
<ol>
<li><code>unhandled.split(SpamError)</code> 返回 <code>(None, unhandled)</code>，<code>unhandled</code> 不变</li>
<li><code>unhandled.split(FooError)</code> 返回<code>match = ExceptionGroup(&#39;msg&#39;, [FooError(1), FooError(2)])</code>、 <code>rest = ExceptionGroup(&#39;msg&#39;, [BazError()])</code>. 这个 <code>except*</code> 块会被执行, <code>e</code> 和 <code>sys.exc_info()</code> 的值被设为 <code>match</code>，<code>unhandled</code> &#x3D; <code>rest</code></li>
<li>第三个也匹配到了， <code>e</code> 和 <code>sys.exc_info()</code> 被设为 <code>ExceptionGroup(&#39;msg&#39;, [BazError()])</code></li>
</ol>
<p>对于嵌套的情况，示例如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">try</span>:</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">raise</span> ExceptionGroup(</span><br><span class="line"><span class="meta">... </span>        <span class="string">&quot;eg&quot;</span>,</span><br><span class="line"><span class="meta">... </span>        [</span><br><span class="line"><span class="meta">... </span>            ValueError(<span class="string">&#x27;a&#x27;</span>),</span><br><span class="line"><span class="meta">... </span>            TypeError(<span class="string">&#x27;b&#x27;</span>),</span><br><span class="line"><span class="meta">... </span>            ExceptionGroup(</span><br><span class="line"><span class="meta">... </span>                <span class="string">&quot;nested&quot;</span>,</span><br><span class="line"><span class="meta">... </span>                [TypeError(<span class="string">&#x27;c&#x27;</span>), KeyError(<span class="string">&#x27;d&#x27;</span>)])</span><br><span class="line"><span class="meta">... </span>        ]</span><br><span class="line"><span class="meta">... </span>    )</span><br><span class="line"><span class="meta">... </span><span class="keyword">except</span>* TypeError <span class="keyword">as</span> e1:</span><br><span class="line"><span class="meta">... </span>    <span class="built_in">print</span>(<span class="string">f&#x27;e1 = <span class="subst">&#123;e1!r&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="meta">... </span><span class="keyword">except</span>* Exception <span class="keyword">as</span> e2:</span><br><span class="line"><span class="meta">... </span>    <span class="built_in">print</span>(<span class="string">f&#x27;e2 = <span class="subst">&#123;e2!r&#125;</span>&#x27;</span>)</span><br><span class="line">...</span><br><span class="line">e1 = ExceptionGroup(<span class="string">&#x27;eg&#x27;</span>, [TypeError(<span class="string">&#x27;b&#x27;</span>), ExceptionGroup(<span class="string">&#x27;nested&#x27;</span>, [TypeError(<span class="string">&#x27;c&#x27;</span>)])])</span><br><span class="line">e2 = ExceptionGroup(<span class="string">&#x27;eg&#x27;</span>, [ValueError(<span class="string">&#x27;a&#x27;</span>), ExceptionGroup(<span class="string">&#x27;nested&#x27;</span>, [KeyError(<span class="string">&#x27;d&#x27;</span>)])])</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>

<p>更多复杂的情况请参考 pep 内容，此处不再赘述</p>
<h2 id="TOML-的标准库支持"><a href="#TOML-的标准库支持" class="headerlink" title="TOML 的标准库支持"></a>TOML 的标准库支持</h2><p>类似于 <code>Json</code> 和 <code>yaml</code>，TOML 也是一种配置文件的格式。它于 <code>2021.1</code> 发布了 <code>v1.0.0</code> 版本。目前，不少的 python 包就使用 TOML 书写配置文件。  </p>
<blockquote>
<p>TOML 旨在成为一个语义明显且易于阅读的最小化配置文件格式。<br>TOML 被设计成可以无歧义地映射为哈希表。<br>TOML 应该能很容易地被解析成各种语言中的数据结构。</p>
</blockquote>
<p>一个 TOML 的文件例子如下：</p>
<figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name</span> = <span class="string">&quot;FunnySaltyFish&quot;</span> </span><br><span class="line"><span class="attr">author.juejin</span> = <span class="string">&quot;https://juejin.cn/user/2673613109214333&quot;</span> </span><br><span class="line"><span class="attr">author.github</span> = <span class="string">&quot;https://github.com/FunnySaltyFish/&quot;</span> </span><br><span class="line"></span><br><span class="line"><span class="section">[blogs]</span></span><br><span class="line"><span class="attr">python1</span> = <span class="string">&quot;https://juejin.cn/post/7146579580176842783&quot;</span></span><br><span class="line"><span class="attr">python2</span> = <span class="string">&quot;https://juejin.cn/post/7015590447745613854&quot;</span></span><br></pre></td></tr></table></figure>

<p>它转化为 Json 如下所示</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;FunnySaltyFish&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;author&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;juejin&quot;</span><span class="punctuation">:</span><span class="string">&quot;https://juejin.cn/user/2673613109214333&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;github&quot;</span><span class="punctuation">:</span><span class="string">&quot;https://github.com/FunnySaltyFish/&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;blogs&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;python1&quot;</span><span class="punctuation">:</span><span class="string">&quot;https://juejin.cn/post/7146579580176842783&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;python2&quot;</span><span class="punctuation">:</span><span class="string">&quot;https://juejin.cn/post/7015590447745613854&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>3.11 中使用的方法也很简单，基本和 <code>json</code> 模块用法类似。不过并未支持写入，需要的话可以用第三方库 <code>toml</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tomllib</span><br><span class="line"></span><br><span class="line">path = <span class="string">&quot;./test.toml&quot;</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(path, <span class="string">&quot;r&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    s = f.read()</span><br><span class="line">    <span class="comment"># loads 从字符串解析</span></span><br><span class="line">    data = tomllib.loads(s)</span><br><span class="line">    <span class="built_in">print</span>(data)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 或者 load 直接读文件</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(path, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> f2:</span><br><span class="line">    data = tomllib.load(f2)</span><br><span class="line">    <span class="built_in">print</span>(data)</span><br><span class="line"></span><br><span class="line"><span class="comment"># tomllib 不支持写入，可以使用 toml 库，它包含 dump/dumps</span></span><br><span class="line"><span class="comment"># toml.dump 和 toml.dumps 均类似 json.dump 和 json.dumps，不赘述</span></span><br><span class="line"><span class="comment"># with open(&quot;./new_config.toml&quot;, &quot;w+&quot;, encoding=&quot;utf-8&quot;) as f:</span></span><br><span class="line"><span class="comment">#     toml.dump(data, f)</span></span><br></pre></td></tr></table></figure>


<h2 id="typing-Self"><a href="#typing-Self" class="headerlink" title="typing.Self"></a>typing.Self</h2><blockquote>
<p><a target="_blank" rel="noopener" href="https://peps.python.org/pep-0673/">PEP 673 – Self Type | peps.python.org</a></p>
</blockquote>
<p>这是 python 的 type hint 的增强，如果不太了解，可以参考我写的 <a target="_blank" rel="noopener" href="https://juejin.cn/post/7146579580176842783">写出更现代化的Python代码：聊聊 Type Hint</a>，里面已经提到了这个特性。<br>简而言之，typing.Self 用于在尚未定义完全的类中代指自己，简单解决了先有鸡还是先有蛋的问题。用法如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> Self</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Shape</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">set_scale</span>(<span class="params">self, scale: <span class="built_in">float</span></span>) -&gt; Self:</span><br><span class="line">        self.scale = scale</span><br><span class="line">        <span class="keyword">return</span> self</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Circle</span>(<span class="title class_ inherited__">Shape</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">set_radius</span>(<span class="params">self, radius: <span class="built_in">float</span></span>) -&gt; Self:</span><br><span class="line">        self.radius = radius</span><br><span class="line">        <span class="keyword">return</span> self</span><br></pre></td></tr></table></figure>

<h2 id="Variadic-Generics-不定长泛型"><a href="#Variadic-Generics-不定长泛型" class="headerlink" title="Variadic Generics 不定长泛型"></a>Variadic Generics 不定长泛型</h2><p>要解释这个，我们需要先提一下<code>泛型</code>。如果你学过其他语言，比如 Java，你不会对这个概念陌生。<br>举个栗子，如果你希望写一个 <code>f</code> 函数，你希望这个函数支持传入类型为 <code>list[int]</code>或<code>list[str]</code>的参数，也就是<strong>各项类型相同且要么为int要么为str的列表</strong>。你可以这样写：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> TypeVar</span><br><span class="line"></span><br><span class="line">T = TypeVar(<span class="string">&quot;T&quot;</span>, <span class="built_in">int</span>, <span class="built_in">str</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">f</span>(<span class="params">arr: <span class="built_in">list</span>[T]</span>) -&gt; T:</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">i = f([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])  <span class="comment"># 合法，i 的类型为 int</span></span><br><span class="line">s = f([<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>])  <span class="comment"># 合法，s 的类型为 str</span></span><br><span class="line">b = f([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3.0</span>]) <span class="comment"># 不合法，因为 3.0 不是 int 或 str</span></span><br></pre></td></tr></table></figure>

<p><code>T</code> 就代表泛型，根据传入的参数情况，被认定为 <code>int</code> 或 <code>str</code>。<br>如果需要写泛型类，我们可以用到 <code>Generic</code>。比如下面的代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">K = TypeVar(<span class="string">&quot;K&quot;</span>, <span class="built_in">int</span>, <span class="built_in">str</span>)</span><br><span class="line">V = TypeVar(<span class="string">&quot;V&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Item</span>(<span class="type">Generic</span>[K, V]):  </span><br><span class="line">    <span class="comment"># Item是一个泛型类，可以确定其中的2个类型</span></span><br><span class="line">    key: K</span><br><span class="line">    value: V</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, k: K, v: V</span>):</span><br><span class="line">        self.key = k</span><br><span class="line">        self.value = v</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">i = Item(<span class="number">1</span>, <span class="string">&#x27;a&#x27;</span>)  <span class="comment"># OK Item是泛型类，所以符合要求的类型值都可以作为参数</span></span><br><span class="line">i2 = Item[<span class="built_in">int</span>, <span class="built_in">str</span>](<span class="number">1</span>, <span class="string">&#x27;a&#x27;</span>)  <span class="comment">#  OK 明确的指定了Item的K, V的类型</span></span><br><span class="line">i3 = Item[<span class="built_in">int</span>, <span class="built_in">int</span>](<span class="number">1</span>, <span class="number">2</span>)  <span class="comment">#  OK 明确的指定成了另外的类型</span></span><br><span class="line">i4 = Item[<span class="built_in">int</span>, <span class="built_in">int</span>](<span class="number">1</span>, <span class="string">&#x27;a&#x27;</span>)  <span class="comment"># Rejected 因为传入的参数和指定的类型V不同</span></span><br></pre></td></tr></table></figure>

<p>此代码引自 <a target="_blank" rel="noopener" href="https://www.dongwm.com/post/python-3-11-new-typing-feature/#PEP646%E2%80%93VariadicGenerics">Python 3.11新加入的和类型系统相关的新特性</a>，一篇很好的文章，大家也可以去看一下</p>
<p>回到本文，为什么 3.11 又提出了个 <code>TypeVarTuple</code> 呢？让我们考虑这样的情况：</p>
<p>我们给定一个函数，它接收一个数组，并且对数据的形状有严格要求。<br><em>事实上，如果你经常用 <code>numpy</code>、<code>tensorflow</code> 或者 <code>pytorch</code> 之类的库，你会经常碰见类似的情况。</em></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">to_gray</span>(<span class="params">videos: Array</span>): ...</span><br></pre></td></tr></table></figure>

<p>但从这个标记中，很难看出数组应该是什么 shape 的。可能是：</p>
<blockquote>
<p>batch × time × height × width × channels</p>
</blockquote>
<p>也或者是</p>
<blockquote>
<p>time × batch × channels × height × width.</p>
</blockquote>
<p>所以，<code>TypeVarTuple</code>就诞生了。我们可以类似这样去写这个类：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> TypeVar, TypeVarTuple</span><br><span class="line"></span><br><span class="line">DType = TypeVar(<span class="string">&#x27;DType&#x27;</span>)</span><br><span class="line">Shape = TypeVarTuple(<span class="string">&#x27;Shape&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Array</span>(<span class="type">Generic</span>[DType, *Shape]):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__abs__</span>(<span class="params">self</span>) -&gt; Array[DType, *Shape]: ...</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__add__</span>(<span class="params">self, other: Array[DType, *Shape]</span>) -&gt; Array[DType, *Shape]: ...</span><br></pre></td></tr></table></figure>

<p>在使用时就可以限制维度和格式：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> NewType</span><br><span class="line"></span><br><span class="line">Height = NewType(<span class="string">&#x27;Height&#x27;</span>, <span class="built_in">int</span>)</span><br><span class="line">Width = NewType(<span class="string">&#x27;Width&#x27;</span>, <span class="built_in">int</span>)</span><br><span class="line"></span><br><span class="line">x: Array[<span class="built_in">float</span>, Height, Width] = Array()</span><br></pre></td></tr></table></figure>

<p>或者甚至指定确切的大小（使用 字面量 Literal）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Literal</span> <span class="keyword">as</span> L</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">x: Array[<span class="built_in">float</span>, L[<span class="number">480</span>], L[<span class="number">640</span>]] = Array()</span><br></pre></td></tr></table></figure>

<p>更多的介绍请参考 pep</p>
<h2 id="任意字符串字面量"><a href="#任意字符串字面量" class="headerlink" title="任意字符串字面量"></a>任意字符串字面量</h2><blockquote>
<p><a target="_blank" rel="noopener" href="https://www.python.org/dev/peps/pep-0675/">PEP 675</a> – Arbitrary Literal String Type</p>
</blockquote>
<h2 id="可选的-TypedDict-键"><a href="#可选的-TypedDict-键" class="headerlink" title="可选的 TypedDict 键"></a>可选的 TypedDict 键</h2><blockquote>
<p><a target="_blank" rel="noopener" href="https://www.python.org/dev/peps/pep-0655/">PEP 655</a> – Marking individual TypedDict items as required or potentially-missing</p>
</blockquote>
<h2 id="数据类变换"><a href="#数据类变换" class="headerlink" title="数据类变换"></a>数据类变换</h2><blockquote>
<p><a target="_blank" rel="noopener" href="https://www.python.org/dev/peps/pep-0681/">PEP 681</a> – Data Class Transforms</p>
</blockquote>
<p>关于上面三者的介绍，我感觉 <a target="_blank" rel="noopener" href="https://www.dongwm.com/post/python-3-11-new-typing-feature/#PEP675%E2%80%93ArbitraryLiteralStringType">Python 3.11新加入的和类型系统相关的新特性</a> 已经很清晰了，我就不重复造轮了。感兴趣的读者可以前往阅读</p>
<h2 id="除此之外"><a href="#除此之外" class="headerlink" title="除此之外"></a>除此之外</h2><p>除了上面提到的 pep，3.11 的主要更新列表还包含两个 gh，分别为 </p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/python/cpython/issues/90908">gh-90908</a> – 为 asyncio 引入任务组</li>
<li><a target="_blank" rel="noopener" href="https://github.com/python/cpython/issues/34627/">gh-34627</a> – 正则表达式项支持 Atomic Grouping (<code>(?&gt;...)</code>) 和 Possessive Quantifiers (<code>*+, ++, ?+, &#123;m,n&#125;+</code>)</li>
</ul>
<p>感兴趣的同学可以自行前往对应链接阅读。</p>
<p>本文完。</p>
<blockquote>
<p>作者 FunnySaltyFish，juejin&#x2F;Github 可直接搜到。本文仅发于掘金和个人网站(blog.funnysaltyfish.fun)，如需交流建议前往这俩平台找我（掘金优先） </p>
</blockquote>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a target="_blank" rel="noopener" href="https://github.com/FunnySaltyFish">FunnySaltyFish</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://blog.funnysaltyfish.fun/2023/01/08/python-311-taste/">https://blog.funnysaltyfish.fun/2023/01/08/python-311-taste/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://blog.funnysaltyfish.fun" target="_blank">FunnySaltyFish's Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Python/">Python</a></div><div class="post_share"><div class="social-share" data-image="/images/bg_python.jpeg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="https://api.funnysaltyfish.fun/wechat.png" target="_blank"><img class="post-qr-code-img" src="https://api.funnysaltyfish.fun/wechat.png" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="https://api.funnysaltyfish.fun/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="https://api.funnysaltyfish.fun/alipay.jpg" alt="alipay"/></a><div class="post-qr-code-desc">alipay</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/01/08/jetpack-compose-130-new/"><img class="prev-cover" src="/images/bg_jetpack_compose.jpeg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Jetpack Compose 上新：瀑布流布局、下拉加载、DrawScope.drawText</div></div></a></div><div class="next-post pull-right"><a href="/2023/01/08/jetpack-compose-calculator/"><img class="next-cover" src="/images/bg_jetpack_compose.jpeg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">入坑 Jetpack Compose ：写一个简单的计算器</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2021/06/01/from-c-to-python/" title="从C到Python"><img class="cover" src="/images/bg_network.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-06-01</div><div class="title">从C到Python</div></div></a></div><div><a href="/2021/10/05/python-3-10-taste/" title="Python3.10稳定版特性速览"><img class="cover" src="/images/bg_python.jpeg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-10-05</div><div class="title">Python3.10稳定版特性速览</div></div></a></div><div><a href="/2021/05/26/python-spider-lesson-1/" title="学了python不知干啥？爬爬虫！（1）爬取网络图片"><img class="cover" src="/images/bg_network.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-05-26</div><div class="title">学了python不知干啥？爬爬虫！（1）爬取网络图片</div></div></a></div><div><a href="/2021/05/26/python-spider-lesson-2/" title="学了python不知干啥？爬爬虫！ （2）爬取网络小说并保存全本"><img class="cover" src="/images/bg_network.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-05-26</div><div class="title">学了python不知干啥？爬爬虫！ （2）爬取网络小说并保存全本</div></div></a></div><div><a href="/2021/05/26/python-spider-lesson-2-5/" title="学了python不知干啥？爬爬虫！ （2.5）爬取有度小说全本+GUI操作界面 完整代码"><img class="cover" src="/images/bg_network.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-05-26</div><div class="title">学了python不知干啥？爬爬虫！ （2.5）爬取有度小说全本+GUI操作界面 完整代码</div></div></a></div><div><a href="/2021/05/26/python-spider-lesson-4/" title="学了python不知干啥？爬爬虫！ （4）多线程爬取"><img class="cover" src="/images/bg_network.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-05-26</div><div class="title">学了python不知干啥？爬爬虫！ （4）多线程爬取</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://web.funnysaltyfish.fun/temp_img/avator.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">FunnySaltyFish</div><div class="author-info__description">Android开发者，努力向全栈靠拢</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">41</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">12</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">4</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/FunnySaltyFish"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/FunnySaltyFish" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:funnysaltyfish@foxmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">欢迎来到FunnySaltyFish的小站！</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BF%AB"><span class="toc-number">1.</span> <span class="toc-text">快</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9B%B4%E5%8F%8B%E5%A5%BD%E7%9A%84%E9%94%99%E8%AF%AF%E6%8F%90%E7%A4%BA"><span class="toc-number">2.</span> <span class="toc-text">更友好的错误提示</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A8%E6%9C%BA"><span class="toc-number">2.1.</span> <span class="toc-text">动机</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%82%E5%B8%B8%E7%BB%84%E4%B8%8E-except"><span class="toc-number">3.</span> <span class="toc-text">异常组与 except *</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A8%E6%9C%BA-1"><span class="toc-number">3.1.</span> <span class="toc-text">动机</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ExceptionGroup"><span class="toc-number">3.2.</span> <span class="toc-text">ExceptionGroup</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#exept"><span class="toc-number">3.3.</span> <span class="toc-text">exept *</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#TOML-%E7%9A%84%E6%A0%87%E5%87%86%E5%BA%93%E6%94%AF%E6%8C%81"><span class="toc-number">4.</span> <span class="toc-text">TOML 的标准库支持</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#typing-Self"><span class="toc-number">5.</span> <span class="toc-text">typing.Self</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Variadic-Generics-%E4%B8%8D%E5%AE%9A%E9%95%BF%E6%B3%9B%E5%9E%8B"><span class="toc-number">6.</span> <span class="toc-text">Variadic Generics 不定长泛型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%BB%E6%84%8F%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%AD%97%E9%9D%A2%E9%87%8F"><span class="toc-number">7.</span> <span class="toc-text">任意字符串字面量</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%AF%E9%80%89%E7%9A%84-TypedDict-%E9%94%AE"><span class="toc-number">8.</span> <span class="toc-text">可选的 TypedDict 键</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%8F%98%E6%8D%A2"><span class="toc-number">9.</span> <span class="toc-text">数据类变换</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%99%A4%E6%AD%A4%E4%B9%8B%E5%A4%96"><span class="toc-number">10.</span> <span class="toc-text">除此之外</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2023/01/08/2022-annual-conclusion/" title="一条咸鱼的2022 | 掘金 &amp; 开源 &amp; 项目"><img src="/images/bg_me.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="一条咸鱼的2022 | 掘金 &amp; 开源 &amp; 项目"/></a><div class="content"><a class="title" href="/2023/01/08/2022-annual-conclusion/" title="一条咸鱼的2022 | 掘金 &amp; 开源 &amp; 项目">一条咸鱼的2022 | 掘金 &amp; 开源 &amp; 项目</a><time datetime="2023-01-08T05:33:28.000Z" title="发表于 2023-01-08 13:33:28">2023-01-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/01/08/jetpack-compose-animated-number/" title="Jetpack Compose 十几行代码快速模仿即刻点赞数字切换效果"><img src="/images/bg_jetpack_compose.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Jetpack Compose 十几行代码快速模仿即刻点赞数字切换效果"/></a><div class="content"><a class="title" href="/2023/01/08/jetpack-compose-animated-number/" title="Jetpack Compose 十几行代码快速模仿即刻点赞数字切换效果">Jetpack Compose 十几行代码快速模仿即刻点赞数字切换效果</a><time datetime="2023-01-08T05:32:27.000Z" title="发表于 2023-01-08 13:32:27">2023-01-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/01/08/jetpack-compose-130-new/" title="Jetpack Compose 上新：瀑布流布局、下拉加载、DrawScope.drawText"><img src="/images/bg_jetpack_compose.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Jetpack Compose 上新：瀑布流布局、下拉加载、DrawScope.drawText"/></a><div class="content"><a class="title" href="/2023/01/08/jetpack-compose-130-new/" title="Jetpack Compose 上新：瀑布流布局、下拉加载、DrawScope.drawText">Jetpack Compose 上新：瀑布流布局、下拉加载、DrawScope.drawText</a><time datetime="2023-01-08T05:31:41.000Z" title="发表于 2023-01-08 13:31:41">2023-01-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/01/08/python-311-taste/" title="Python 3.11.0 正式发布！主要新特性一览"><img src="/images/bg_python.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Python 3.11.0 正式发布！主要新特性一览"/></a><div class="content"><a class="title" href="/2023/01/08/python-311-taste/" title="Python 3.11.0 正式发布！主要新特性一览">Python 3.11.0 正式发布！主要新特性一览</a><time datetime="2023-01-08T05:30:44.000Z" title="发表于 2023-01-08 13:30:44">2023-01-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/01/08/jetpack-compose-calculator/" title="入坑 Jetpack Compose ：写一个简单的计算器"><img src="/images/bg_jetpack_compose.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="入坑 Jetpack Compose ：写一个简单的计算器"/></a><div class="content"><a class="title" href="/2023/01/08/jetpack-compose-calculator/" title="入坑 Jetpack Compose ：写一个简单的计算器">入坑 Jetpack Compose ：写一个简单的计算器</a><time datetime="2023-01-08T05:29:37.000Z" title="发表于 2023-01-08 13:29:37">2023-01-08</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By FunnySaltyFish</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a><span class="footer-separator">|</span><a href="https://beian.miit.gov.cn/" target="_blank">京ICP备2021034074号-1</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">简</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><div class="js-pjax"><script>(() => {
  const $mermaidWrap = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaidWrap.length) {
    window.runMermaid = () => {
      window.loadMermaid = true
      const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? '' : ''

      Array.from($mermaidWrap).forEach((item, index) => {
        const mermaidSrc = item.firstElementChild
        const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
        const mermaidID = 'mermaid-' + index
        const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent
        mermaid.mermaidAPI.render(mermaidID, mermaidDefinition, (svgCode) => {
          mermaidSrc.insertAdjacentHTML('afterend', svgCode)
        })
      })
    }

    const loadMermaid = () => {
      window.loadMermaid ? runMermaid() : getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaid)
    }

    window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
  }
})()</script><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'DrYO0lpXckTt9I0mnE7I7VNP-gzGzoHsz',
      appKey: 'zFhG6sXrcgJuwXdrxt1igoYf',
      avatar: 'monsterid',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !false) {
  if (false) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>