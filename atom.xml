<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>FunnySaltyFish&#39;s Blog</title>
  
  <subtitle>FunnySaltyFish的小站</subtitle>
  <link href="https://funnysaltyfish.vercel.app/atom.xml" rel="self"/>
  
  <link href="https://funnysaltyfish.vercel.app/"/>
  <updated>2021-10-05T14:30:00.029Z</updated>
  <id>https://funnysaltyfish.vercel.app/</id>
  
  <author>
    <name>FunnySaltyFish</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Python3.10稳定版特性速览</title>
    <link href="https://funnysaltyfish.vercel.app/2021/10/05/python-3-10-taste/"/>
    <id>https://funnysaltyfish.vercel.app/2021/10/05/python-3-10-taste/</id>
    <published>2021-10-05T14:25:59.000Z</published>
    <updated>2021-10-05T14:30:00.029Z</updated>
    
    <content type="html"><![CDATA[<p>Python 3.10正式发布，你尝鲜了吗？</p><blockquote><p>本文参考自 Python官方文档 ： <a href="https://www.python.org/downloads/release/python-3100/">Python Release Python 3.10.0 | Python.org</a></p></blockquote><p>在正值国庆假期人山人海的2021年10月4号，Python官方<a href="https://www.python.org/downloads/release/python-3100/">正式发布了Python3.10.0</a>。作为一只假期期间宅着不动的coding人，自然是第一时间体验了一波。相较于之前的版本，该版本有以下主要变更。</p><h3 id="新的-Union-Type表达"><a href="#新的-Union-Type表达" class="headerlink" title="新的 Union Type表达"></a>新的 Union Type表达</h3><p>新版本简化了 Union Type 的使用 ，改为更为简洁的<code>|</code> </p><p>旧版：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Union</span></span><br><span class="line">a: <span class="type">Union</span>[<span class="built_in">int</span>, <span class="built_in">str</span>] = <span class="number">1</span></span><br></pre></td></tr></table></figure><p>新的版本：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a: <span class="built_in">str</span> | <span class="built_in">int</span> = <span class="number">1</span></span><br></pre></td></tr></table></figure><p>二者完全等价：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Union</span>[<span class="built_in">int</span>, <span class="built_in">str</span>] == <span class="built_in">int</span> | <span class="built_in">str</span> <span class="comment"># True</span></span><br></pre></td></tr></table></figure><p>这类变化在其他地方也相似：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 旧版:</span></span><br><span class="line"><span class="comment"># def f(list: List[Union[int, str]], param: Optional[int]) -&gt; Union[float, str]</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span>(<span class="params"><span class="built_in">list</span>: <span class="type">List</span>[<span class="built_in">int</span> | <span class="built_in">str</span>], param: <span class="built_in">int</span> | <span class="literal">None</span></span>) -&gt; <span class="built_in">float</span> | <span class="built_in">str</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">f([<span class="number">1</span>, <span class="string">&quot;abc&quot;</span>], <span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 旧版： </span></span><br><span class="line"><span class="comment"># typing.List[typing.Union[str, int]]</span></span><br><span class="line">typing.<span class="type">List</span>[<span class="built_in">str</span> | <span class="built_in">int</span>]</span><br><span class="line"><span class="built_in">list</span>[<span class="built_in">str</span> | <span class="built_in">int</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 旧版： </span></span><br><span class="line"><span class="comment"># typing.Dict[str, typing.Union[int, float]]</span></span><br><span class="line">typing.<span class="type">Dict</span>[<span class="built_in">str</span>, <span class="built_in">int</span> | <span class="built_in">float</span>]</span><br><span class="line"><span class="built_in">dict</span>[<span class="built_in">str</span>, <span class="built_in">int</span> | <span class="built_in">float</span>]</span><br></pre></td></tr></table></figure><p>该特性也可用于 <code>isinstance</code>和<code>issubclass</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># True</span></span><br><span class="line"><span class="built_in">isinstance</span>(<span class="string">&quot;FunnySaltyFish&quot;</span>, <span class="built_in">int</span>|<span class="built_in">str</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># True </span></span><br><span class="line"><span class="built_in">issubclass</span>(<span class="built_in">str</span>, <span class="built_in">str</span>|<span class="built_in">int</span>)</span><br></pre></td></tr></table></figure><h3 id="zip-可选严格模式"><a href="#zip-可选严格模式" class="headerlink" title="zip 可选严格模式"></a>zip 可选严格模式</h3><p>zip新增可选参数<code>strict</code>， 当该选项为True时，传入zip的两个可迭代项长度必须相等，否则将抛出 <code>ValueError</code></p><p>旧版（及不加此参数），当二者长度不等时，以长度较小的为准</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">names = [<span class="string">&quot;a&quot;</span>,<span class="string">&quot;b&quot;</span>,<span class="string">&quot;c&quot;</span>,<span class="string">&quot;d&quot;</span>]</span><br><span class="line">numbers = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line">z = <span class="built_in">zip</span>(names,numbers)</span><br><span class="line"><span class="keyword">for</span> each <span class="keyword">in</span> z:</span><br><span class="line">    <span class="built_in">print</span>(each)</span><br><span class="line">    </span><br><span class="line"><span class="comment"># (&#x27;a&#x27;, 1)</span></span><br><span class="line"><span class="comment"># (&#x27;b&#x27;, 2)</span></span><br><span class="line"><span class="comment"># (&#x27;c&#x27;, 3)</span></span><br></pre></td></tr></table></figure><p>设置strict为True</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ...</span></span><br><span class="line">z = <span class="built_in">zip</span>(names,numbers,strict=<span class="literal">True</span>)</span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line"></span><br><span class="line">d:\projects\python\learn\Py310探索.py <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">      <span class="number">3</span> numbers = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line">      <span class="number">4</span> z = <span class="built_in">zip</span>(names,numbers,strict=<span class="literal">True</span>)</span><br><span class="line">----&gt; <span class="number">5</span> <span class="keyword">for</span> each <span class="keyword">in</span> z:</span><br><span class="line">      <span class="number">6</span>     <span class="built_in">print</span>(each)</span><br><span class="line"></span><br><span class="line">ValueError: <span class="built_in">zip</span>() argument <span class="number">2</span> <span class="keyword">is</span> shorter than argument <span class="number">1</span></span><br></pre></td></tr></table></figure><h3 id="带括号的上下文管理器"><a href="#带括号的上下文管理器" class="headerlink" title="带括号的上下文管理器"></a>带括号的上下文管理器</h3><p>with可以加括号了</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> (CtxManager() <span class="keyword">as</span> example):</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> (</span><br><span class="line">    CtxManager1(),</span><br><span class="line">    CtxManager2()</span><br><span class="line">):</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> (CtxManager1() <span class="keyword">as</span> example,</span><br><span class="line">      CtxManager2()):</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> (CtxManager1(),</span><br><span class="line">      CtxManager2() <span class="keyword">as</span> example):</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> (</span><br><span class="line">    CtxManager1() <span class="keyword">as</span> example1,</span><br><span class="line">    CtxManager2() <span class="keyword">as</span> example2</span><br><span class="line">):</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure><p>如</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pathlib</span><br><span class="line">p = pathlib.Path()</span><br><span class="line">p1 = p/<span class="string">&quot;text1.txt&quot;</span> <span class="comment"># 内容：文本1的内容</span></span><br><span class="line">p2 = p/<span class="string">&quot;text2.txt&quot;</span> <span class="comment"># 内容：文本2的内容</span></span><br><span class="line"><span class="keyword">with</span>(</span><br><span class="line">    p1.<span class="built_in">open</span>(encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f1,</span><br><span class="line">    p2.<span class="built_in">open</span>(encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f2</span><br><span class="line">):</span><br><span class="line">    <span class="built_in">print</span>(f1.read(), f2.read(), sep=<span class="string">&quot;\n&quot;</span>) </span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 文本1的内容</span></span><br><span class="line">    <span class="comment"># 文本2的内容</span></span><br></pre></td></tr></table></figure><h3 id="显式类型别名"><a href="#显式类型别名" class="headerlink" title="显式类型别名"></a>显式类型别名</h3><p>使用 TypeAlias 显式标注类型别名，提高可读性</p><p>旧的方式：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">x = <span class="built_in">int</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">plus_int</span>(<span class="params">a:x,b:x</span>) -&gt; x:</span></span><br><span class="line">    <span class="keyword">return</span> a+b</span><br></pre></td></tr></table></figure><p>可以看到，x很容易被搞混</p><p>新的方式：使用 TypeAlias表明这是个别名 </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> TypeAlias</span><br><span class="line">x : TypeAlias = <span class="built_in">int</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">plus_int</span>(<span class="params">a:x,b:x</span>) -&gt; x:</span></span><br><span class="line">    <span class="keyword">return</span> a+b</span><br></pre></td></tr></table></figure><h3 id="match…case语句"><a href="#match…case语句" class="headerlink" title="match…case语句"></a>match…case语句</h3><p>对，就是其他语言的<code>switch-case</code>，python终于提供了支持，还是加强版的</p><p>完整语法参见：<a href="https://www.python.org/dev/peps/pep-0634/#id25">PEP 634 – Structural Pattern Matching: Specification | Python.org</a></p><p>举几个例子：</p><p>基本的类型匹配：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">day = <span class="number">6</span></span><br><span class="line">match day:</span><br><span class="line">    case <span class="number">1</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;星期一&quot;</span>)</span><br><span class="line">    case <span class="number">6</span> | <span class="number">7</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;周末&quot;</span>)</span><br><span class="line">    case _ : </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;其他情况&quot;</span>)</span><br></pre></td></tr></table></figure><p>subject：这在处理命令行参数的时候特别有用</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    @copyright : [FunnySaltyFish](https://funnysaltyfish.github.io)</span></span><br><span class="line"><span class="string">    @date : 2021/10/05 21:08:42</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">command = <span class="string">&quot;save 1.txt&quot;</span></span><br><span class="line"><span class="comment"># 试着把command改成 list / copy 1.txt 2.txt 看看效果</span></span><br><span class="line">match command.split(<span class="string">&quot; &quot;</span>):</span><br><span class="line">    case [<span class="string">&quot;list&quot;</span>]:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;列出文件~&quot;</span>)</span><br><span class="line">    case [<span class="string">&quot;save&quot;</span>, file_name]:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;保存文件到 <span class="subst">&#123;file_name&#125;</span>&quot;</span>)</span><br><span class="line">    case [<span class="string">&quot;copy&quot;</span>,source,target]:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;拷贝 <span class="subst">&#123;source&#125;</span> -&gt; <span class="subst">&#123;target&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure><p>也可以匹配对象：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>():</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span>(<span class="params">Person</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, <span class="built_in">id</span>: <span class="built_in">int</span></span>) -&gt; <span class="literal">None</span>:</span></span><br><span class="line">        self.<span class="built_in">id</span> = <span class="built_in">id</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Teacher</span>(<span class="params">Person</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name: <span class="built_in">str</span></span>) -&gt; <span class="literal">None</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line"></span><br><span class="line">a = Student(<span class="number">1</span>)</span><br><span class="line"><span class="comment"># a = Student(2)</span></span><br><span class="line"><span class="comment"># a = Teacher(&quot;FunnySaltyFish&quot;)</span></span><br><span class="line">match a:</span><br><span class="line">    case Student(<span class="built_in">id</span> = <span class="number">2</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;这是位学生，且id正好是2&quot;</span>)</span><br><span class="line">    case Student():</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;这是学生，id为<span class="subst">&#123;a.<span class="built_in">id</span>&#125;</span>&quot;</span>)</span><br><span class="line">    case Teacher():</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;这是老师, 姓名为<span class="subst">&#123;a.name&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure><p>当然也可以匹配字典：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">d = &#123;</span><br><span class="line">    <span class="string">&quot;name&quot;</span> : <span class="string">&quot;李四&quot;</span>, <span class="comment"># 张三</span></span><br><span class="line">    <span class="string">&quot;age&quot;</span> : <span class="number">18</span>,</span><br><span class="line">    <span class="string">&quot;hobby&quot;</span> : <span class="string">&quot;阅读&quot;</span></span><br><span class="line">&#125; </span><br><span class="line">match d:</span><br><span class="line">    case &#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;张三&quot;</span>, **args&#125;:</span><br><span class="line">        <span class="comment"># **收集其他参数</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;这是张三&quot;</span>, args) <span class="comment"># 这是张三 &#123;&#x27;age&#x27;: 18, &#x27;hobby&#x27;: &#x27;阅读&#x27;&#125;</span></span><br><span class="line">    case &#123;<span class="string">&quot;name&quot;</span> : name , <span class="string">&quot;age&quot;</span> : age, <span class="string">&quot;hobby&quot;</span>: hobby&#125;:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;我叫<span class="subst">&#123;name&#125;</span>, 今年<span class="subst">&#123;age&#125;</span>岁, 喜欢<span class="subst">&#123;hobby&#125;</span>&quot;</span>) <span class="comment">#我叫李四,今年18岁，喜欢阅读</span></span><br></pre></td></tr></table></figure><p>更复杂的还有结合Guard、匹配捕获等使用，具体可以参见：<a href="https://www.python.org/dev/peps/pep-0635/#id15">PEP 635 – Structural Pattern Matching: Motivation and Rationale | Python.org</a> 和 <a href="https://www.python.org/dev/peps/pep-0636/">PEP 636 – Structural Pattern Matching: Tutorial | Python.org</a></p><h3 id="更友好的报错提示"><a href="#更友好的报错提示" class="headerlink" title="更友好的报错提示"></a>更友好的报错提示</h3><p>现在，当你的括号、引号未闭合时，python会抛出更加清晰明了的错误</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">str</span> = <span class="string">&quot;未闭合的str</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">File &quot;</span>d:\projects\python\learn\Py310探索.py<span class="string">&quot;, line 90</span></span><br><span class="line"><span class="string">    str = &quot;</span>未闭合的<span class="built_in">str</span></span><br><span class="line">          ^</span><br><span class="line">SyntaxError: unterminated string literal (detected at line <span class="number">90</span>)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span></span><br><span class="line">    </span><br><span class="line">  File <span class="string">&quot;d:\projects\python\learn\Py310探索.py&quot;</span>, line <span class="number">91</span></span><br><span class="line">    arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span></span><br><span class="line">          ^</span><br><span class="line">SyntaxError: <span class="string">&#x27;[&#x27;</span> was never closed</span><br></pre></td></tr></table></figure><h3 id="其他一些更新："><a href="#其他一些更新：" class="headerlink" title="其他一些更新："></a>其他一些更新：</h3><h4 id="distutils-被弃用"><a href="#distutils-被弃用" class="headerlink" title="distutils 被弃用"></a>distutils 被弃用</h4><p>推荐使用 setuptools</p><h4 id="需要-OpenSSL-1-1-1-及以上版本"><a href="#需要-OpenSSL-1-1-1-及以上版本" class="headerlink" title="需要  OpenSSL 1.1.1 及以上版本"></a>需要  OpenSSL 1.1.1 及以上版本</h4><h4 id="移除-Py-UNICODE编码API"><a href="#移除-Py-UNICODE编码API" class="headerlink" title="移除 Py_UNICODE编码API"></a>移除 Py_UNICODE编码API</h4><h4 id="PyUnicodeObject的wstr被弃用，并将在之后移除"><a href="#PyUnicodeObject的wstr被弃用，并将在之后移除" class="headerlink" title="PyUnicodeObject的wstr被弃用，并将在之后移除"></a>PyUnicodeObject的wstr被弃用，并将在之后移除</h4><p>完。摸鱼去了。</p><blockquote><p>作者：FunnySaltyFish<br>主页：<a href="https://funnysaltyfish.github.io/">https://funnysaltyfish.github.io/</a></p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Python 3.10正式发布，你尝鲜了吗？&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;本文参考自 Python官方文档 ： &lt;a href=&quot;https://www.python.org/downloads/release/python-3100/&quot;&gt;Python Rele</summary>
      
    
    
    
    
    <category term="Python" scheme="https://funnysaltyfish.vercel.app/tags/Python/"/>
    
  </entry>
  
  <entry>
    <title>Jitpack.io ERROR No build artifacts found一路踩坑的解决【Gradle 7.0+,Kotlin 1.5+】</title>
    <link href="https://funnysaltyfish.vercel.app/2021/07/26/jitpack-build-error-solve/"/>
    <id>https://funnysaltyfish.vercel.app/2021/07/26/jitpack-build-error-solve/</id>
    <published>2021-07-26T10:15:04.000Z</published>
    <updated>2021-07-26T10:18:57.942Z</updated>
    
    <content type="html"><![CDATA[<p>前段时间上传我的项目<a href="https://github.com/FunnySaltyFish/CMaterialColors/">CMaterialColors</a>到Jitpack时一直出现错误，最早报出的错误是：</p><blockquote><p>Found artifact: com.funny.cmaterialcolors:release:1.0.0<br>Found artifact: com.funny.cmaterialcolors:release:<br>2021-06-15T08:52:13.4704949Z<br>Exit code: 0<br>ERROR: No build artifacts found</p></blockquote><p>实话说当时非常无语，经过几次失败的尝试后我决定去看看完整的报错日志，然后发现了中间其实就有报错：</p><blockquote><p>An exception occurred applying plugin request [id: ‘com.android.application’]<br>Failed to apply plugin ‘com.android.internal.application’.<br>Android Gradle plugin requires Java 11 to run. You are currently using Java 1.8.<br>     You can try some of the following options:<br>       - changing the IDE settings.<br>       - changing the JAVA_HOME environment variable.<br>       - changing <code>org.gradle.java.home</code> in <code>gradle.properties</code>.</p></blockquote><p>意思是要去修改默认的Java编译环境，查阅Jitpack官方英文<a href="https://github.com/jitpack/jitpack.io/blob/master/BUILDING.md">文档</a>，找到了如下解决措施：</p><blockquote><p>You can create a jitpack.yml file in the root of your repository and override the build commands:</p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">jdk:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">openjdk9</span></span><br></pre></td></tr></table></figure><p>翻译成中文就是：</p><ul><li>在<strong>项目根目录</strong>创建文件<code>jitpack.yml</code></li><li>在里面添加上述文本即可指定编译用的Java版本</li></ul><p>于是，在解决完了这个问题后，我怀着信心满满的心情再次提交，而这一次……<br>然并卵，错误还是存在……</p><p>老实说这个错误真是非常迷惑的。我又尝试了一些方法，均未果。然后没办法，继续回去看文档呗。<br>我项目里面用的是<code>maven-publish</code>插件，官方文档说执行的命令是</p><blockquote><p>./gradlew build publishToMavenLocal</p></blockquote><p>然后在终端里面试了试，发现居然报错了！<br>然后又是按对应的报错改Bug，直到本地可以正常执行此命令<br>改完之后信心满满的提交，结果新的错误产生了……</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Could not resolve compiler classpath. Check <span class="keyword">if</span> Kotlin Gradle plugin repository is configured <span class="keyword">in</span> project <span class="string">&#x27;:app&#x27;</span>.</span><br><span class="line"></span><br><span class="line">FAILURE: Build failed with an exception.</span><br><span class="line"></span><br><span class="line">* What went wrong:</span><br><span class="line">Could not determine the dependencies of task <span class="string">&#x27;:app:compileReleaseKotlin&#x27;</span>.</span><br><span class="line">&gt; Could not resolve all files <span class="keyword">for</span> configuration <span class="string">&#x27;:app:kotlinCompilerClasspath&#x27;</span>.</span><br><span class="line">   &gt; Cannot resolve external dependency org.jetbrains.kotlin:kotlin-compiler-embeddable:1.5.10 because no repositories are defined.</span><br><span class="line">     Required by:</span><br><span class="line">         project :app</span><br></pre></td></tr></table></figure><p>我TM！！！<br>网上搜根本搜不到对应的解决措施，没办法一点点改呗。<br>又试了几次，还是不行。<br>这时想到了一个办法，我开始去翻Github，找与我的项目使用的依赖库相似的项目（kotlin 1.5，Gradle 7.0，Compose 1.0.0-rc01），然后对照它的项目文件一个个看。<br>最后找到了差异，我的<code>lib/build.gradle</code>里面少写了这一行：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// kotlin</span><br><span class="line">implementation <span class="string">&quot;org.jetbrains.kotlin:kotlin-stdlib-jdk8:<span class="variable">$kotlin_version</span>&quot;</span></span><br></pre></td></tr></table></figure><p>终于，在版本都累加到<code>1.0.21</code>后，我终终终终终于提交成功了！<br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/9fdcfa0d460e44bea18538ff9999a8cf.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTk2MDY3,size_16,color_FFFFFF,t_70#pic_center" alt="终于"></p><p>那一刻，真的，难以言表！！！</p><p>最后吐个槽，各位博主大大抄袭文章能不能有个限度，nm各个文章都在用着早已被废弃的插件，jdk11的问题都没得人指出。简直了。。。</p><p><strong>如果你需要参考对应文件，可以点击这个开源库：<a href="https://github.com/FunnySaltyFish/CMaterialColors/">CMaterialColors</a></strong></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;前段时间上传我的项目&lt;a href=&quot;https://github.com/FunnySaltyFish/CMaterialColors/&quot;&gt;CMaterialColors&lt;/a&gt;到Jitpack时一直出现错误，最早报出的错误是：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;F</summary>
      
    
    
    
    
    <category term="Jitpack" scheme="https://funnysaltyfish.vercel.app/tags/Jitpack/"/>
    
  </entry>
  
  <entry>
    <title>Jetpack Compose异步加载图片的实现</title>
    <link href="https://funnysaltyfish.vercel.app/2021/07/14/jetpack-compose-sync-load-image/"/>
    <id>https://funnysaltyfish.vercel.app/2021/07/14/jetpack-compose-sync-load-image/</id>
    <published>2021-07-14T11:25:27.000Z</published>
    <updated>2021-07-14T11:29:52.771Z</updated>
    
    <content type="html"><![CDATA[<p>本文使用两种方式，实现Compose中图片的异步加载</p><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>Android开发中异步加载图片是非常常见的需求。本文将带你实现这一需求。<br>本文将分为如下两个方面：</p><ol><li>自己写函数</li><li>用开源库</li></ol><hr><h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><h3 id="借助Glide库自己写"><a href="#借助Glide库自己写" class="headerlink" title="借助Glide库自己写"></a>借助Glide库自己写</h3><p>Glide开源库基本上成为了Android中加载图片的首选，其简单易用的API和强大的缓存能力让这一过程变得十分方便。<br>自然在Jetpack Compose中也可以使用。</p><h4 id="引入依赖"><a href="#引入依赖" class="headerlink" title="引入依赖"></a>引入依赖</h4><p>在模块中的<code>build.gradle</code>中加入</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">implementation <span class="string">&#x27;com.github.bumptech.glide:glide:4.12.0&#x27;</span></span><br><span class="line">annotationProcessor <span class="string">&#x27;com.github.bumptech.glide:compiler:4.12.0&#x27;</span></span><br></pre></td></tr></table></figure><h4 id="编写函数"><a href="#编写函数" class="headerlink" title="编写函数"></a>编写函数</h4><p>如何让Glide把图片加载到Compose组件上去呢？我们可以利用其提供的<code>into(Target)</code>指定自定义的target，再搭配上<code>mutableState&lt;Bitmap&gt;</code>的返回值，即可实现在图片加载完成后Compose自动更新<br>图片加载时一般会有一个默认的<code>loading</code>图，我们可以如法炮制，让Glide先帮我们加载一张本地图片，然后再去加载网络图片即可。<br>编写的函数如下：</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 使用Glide库加载网络图片</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> [FunnySaltyFish](https://funnysaltyfish.github.io)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021-07-14</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> context Context 合理的Context</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> url String 加载的图片URL</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> defaultImageId Int 默认加载的本地图片</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> MutableState&lt;Bitmap?&gt; 加载完成（失败为null）的Bitmap-State</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">loadImage</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    context: <span class="type">Context</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    url: <span class="type">String</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="meta">@DrawableRes</span> defaultImageId: <span class="type">Int</span> = R.drawable.load_holder</span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>: MutableState&lt;Bitmap?&gt; &#123;</span><br><span class="line">    <span class="keyword">val</span> TAG = <span class="string">&quot;LoadImage&quot;</span></span><br><span class="line">    <span class="keyword">val</span> bitmapState: MutableState&lt;Bitmap?&gt; = mutableStateOf(<span class="literal">null</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//为请求加上 Headers ，提高访问成功率</span></span><br><span class="line">    <span class="keyword">val</span> glideUrl = GlideUrl(url,LazyHeaders.Builder().addHeader(<span class="string">&quot;User-Agent&quot;</span>,<span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36 Edg/91.0.864.67&quot;</span>).build())</span><br><span class="line"></span><br><span class="line">    <span class="comment">//先加载本地图片</span></span><br><span class="line">    Glide.with(context)</span><br><span class="line">        .asBitmap()</span><br><span class="line">        .load(defaultImageId)</span><br><span class="line">        .into(<span class="keyword">object</span> : CustomTarget&lt;Bitmap&gt;() &#123;</span><br><span class="line">            <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onResourceReady</span><span class="params">(resource: <span class="type">Bitmap</span>, transition: <span class="type">Transition</span>&lt;<span class="type">in</span> <span class="type">Bitmap</span>&gt;?)</span></span> &#123;</span><br><span class="line">                <span class="comment">//自定义Target，在加载完成后将图片资源传递给bitmapState</span></span><br><span class="line">                bitmapState.value = resource</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onLoadCleared</span><span class="params">(placeholder: <span class="type">Drawable</span>?)</span></span> &#123;&#125;</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//然后再加载网络图片</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        Glide.with(context)</span><br><span class="line">            .asBitmap()</span><br><span class="line">            .load(glideUrl)</span><br><span class="line">            .into(<span class="keyword">object</span> : CustomTarget&lt;Bitmap&gt;() &#123;</span><br><span class="line">                <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onResourceReady</span><span class="params">(resource: <span class="type">Bitmap</span>, transition: <span class="type">Transition</span>&lt;<span class="type">in</span> <span class="type">Bitmap</span>&gt;?)</span></span> &#123;</span><br><span class="line">                    <span class="comment">//自定义Target，在加载完成后将图片资源传递给bitmapState</span></span><br><span class="line">                    bitmapState.value = resource</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onLoadCleared</span><span class="params">(placeholder: <span class="type">Drawable</span>?)</span></span> &#123;&#125;</span><br><span class="line">            &#125;)</span><br><span class="line">    &#125; <span class="keyword">catch</span> (glideException: GlideException) &#123;</span><br><span class="line">        Log.d(TAG, <span class="string">&quot;loadImage: <span class="subst">$&#123;glideException.rootCauses&#125;</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> bitmapState</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="使用例子"><a href="#使用例子" class="headerlink" title="使用例子"></a>使用例子</h4><p>简单的例子如下：</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">LoadPicture</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    url : <span class="type">String</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> imageState = loadImage(</span><br><span class="line">        context = LocalContext.current,</span><br><span class="line">        url = url,</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    Card(modifier = Modifier</span><br><span class="line">        .padding(<span class="number">4.</span>dp)</span><br><span class="line">        .clickable &#123; &#125;) &#123;</span><br><span class="line">        <span class="comment">//如果图片加载成功</span></span><br><span class="line">        imageState.value?.let &#123;</span><br><span class="line">            Image(</span><br><span class="line">                bitmap = it.asImageBitmap(),</span><br><span class="line">                contentDescription = <span class="string">&quot;&quot;</span>,</span><br><span class="line">                modifier = Modifier</span><br><span class="line">                    .padding(<span class="number">4.</span>dp)</span><br><span class="line">                    .fillMaxWidth()</span><br><span class="line">            )</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//......</span></span><br><span class="line"></span><br><span class="line">LazyColumn &#123;</span><br><span class="line">    <span class="keyword">val</span> urls = arrayListOf&lt;String&gt;()</span><br><span class="line">    <span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">500.</span><span class="number">.550</span>)&#123;urls.add(<span class="string">&quot;https://nyc3.digitaloceanspaces.com/food2fork/food2fork-static/featured_images/<span class="variable">$i</span>/featured_image.png&quot;</span>)&#125;</span><br><span class="line">    itemsIndexed(urls)&#123; _ , url -&gt; LoadPicture(url = url)&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>效果如下图所示：<br><strong>加载中</strong></p><p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20210714190357323.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTk2MDY3,size_16,color_FFFFFF,t_70#pic_center" alt="加载中"><br><strong>加载完毕</strong><br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20210714190734214.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTk2MDY3,size_16,color_FFFFFF,t_70#pic_center" alt="加载成功"><br><code>P.S.：别忘了声明网络权限哦！</code></p><h3 id="借助开源框架"><a href="#借助开源框架" class="headerlink" title="借助开源框架"></a>借助开源框架</h3><p>事实上，谷歌在其<a href="https://developer.android.google.cn/jetpack/compose/libraries">开发文档</a>中也给出了示例，用的是开源库<a href="https://github.com/google/accompanist">Accompanist</a><br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20210714191039630.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTk2MDY3,size_16,color_FFFFFF,t_70#pic_center" alt="谷歌的官方例子"><br>所以我们也可以用这个</p><h4 id="简单的例子"><a href="#简单的例子" class="headerlink" title="简单的例子"></a>简单的例子</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">implementation <span class="string">&quot;com.google.accompanist:accompanist-coil:0.13.0&quot;</span></span><br></pre></td></tr></table></figure><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> [FunnySaltyFish](https://funnysaltyfish.github.io)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021-07-14</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> url 加载的链接</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">LoadPicture2</span><span class="params">(url:<span class="type">String</span>)</span></span>&#123;</span><br><span class="line">    <span class="keyword">val</span> painter = rememberCoilPainter(url)</span><br><span class="line"></span><br><span class="line">    Box &#123;</span><br><span class="line">        Image(</span><br><span class="line">            painter = painter,</span><br><span class="line">            contentDescription = <span class="string">&quot;&quot;</span>,</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        <span class="keyword">when</span> (painter.loadState) &#123;</span><br><span class="line">            <span class="keyword">is</span> ImageLoadState.Loading -&gt; &#123;</span><br><span class="line">                <span class="comment">// 显示一个加载中的进度条</span></span><br><span class="line">                CircularProgressIndicator(Modifier.align(Alignment.Center))</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">is</span> ImageLoadState.Error -&gt; &#123;</span><br><span class="line">                <span class="comment">// 如果发生了什么错误，你可以在这里写</span></span><br><span class="line">                Text(text = <span class="string">&quot;发生错误&quot;</span>, color = MaterialColors.RedA200)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> -&gt; Text(text = <span class="string">&quot;未知情况&quot;</span>, color = MaterialColors.PurpleA400)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>效果如下：<br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20210714191350243.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTk2MDY3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20210714191350753.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTk2MDY3,size_16,color_FFFFFF,t_70#pic_center" alt="加载中"></p><p><code>P.S.：如果想更好的看到加载的情况，可以在模拟器设置中将网络类型设置为较慢的类型</code></p><h4 id="一些限制"><a href="#一些限制" class="headerlink" title="一些限制"></a>一些限制</h4><p>个人感觉，这种方式有以下的问题：</p><ul><li>滑动加载时不如Glide流畅</li><li>对Kotlin版本有要求，如（截止文章写作时）最新的<code>0.13.0</code>版就必须用<code>kotlin1.5</code>及以上版本，否则就会编译出错</li></ul><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul><li><a href="https://www.youtube.com/watch?v=ktOWiLx83bQ&list=PLgCYzUzKIBE_I0_tU5TvkfQpnmrP_9XV8&index=20">视频</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;本文使用两种方式，实现Compose中图片的异步加载&lt;/p&gt;
&lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h2&gt;&lt;p&gt;Android开发中异步加载图片是非常常见的需求。本文将带你实现这一需求</summary>
      
    
    
    
    
    <category term="Jetpack Compose" scheme="https://funnysaltyfish.vercel.app/tags/Jetpack-Compose/"/>
    
  </entry>
  
  <entry>
    <title>从C到Python</title>
    <link href="https://funnysaltyfish.vercel.app/2021/06/01/from-c-to-python/"/>
    <id>https://funnysaltyfish.vercel.app/2021/06/01/from-c-to-python/</id>
    <published>2021-06-01T00:00:00.000Z</published>
    <updated>2021-07-07T06:34:14.087Z</updated>
    
    <content type="html"><![CDATA[<h2 id="从C到Python"><a href="#从C到Python" class="headerlink" title="从C到Python"></a>从C到Python</h2><p>本文适合于那些有过一定C语言基础并希望学习Python的人，仅在简明指出二者的过渡。</p><p>首先请记住：Python入门<strong>非常容易</strong>，所以在阅读本文时，请不必抱有任何心理压力！<strong>看不懂的跳过就行，日后自然会理解</strong></p><hr><h3 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h3><ol><li>目前Python主流版本有2.X和3.X，本文使用的版本为<code>Python 3.8.5</code></li><li>C环境则为 gcc 8.1.0</li><li>如对应知识点下面有小字，则为补充及说明内容，您可按需阅读</li></ol><h3 id="宏观"><a href="#宏观" class="headerlink" title="宏观"></a>宏观</h3><p>下面从大体上阐释二者的部分区别</p><ol><li>Python代码写起来比C语言<strong>简明得多</strong></li><li>Python是一门<strong>面向对象</strong>的语言，C语言则是<strong>面向过程</strong></li><li>Python是一门解释型语言，C则是编译型语言</li></ol><p>上面的话有个概念就好，不必死磕。</p><h3 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h3><p>在C语言中，变量分为声明和定义，且需要指出详细的类型，如下：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//变量声明</span></span><br><span class="line">   <span class="keyword">int</span> i;</span><br><span class="line">   <span class="keyword">float</span> f;</span><br><span class="line">   <span class="keyword">double</span> d;</span><br><span class="line">   <span class="keyword">char</span> c;</span><br><span class="line">   <span class="keyword">long</span> l;</span><br><span class="line">   <span class="keyword">short</span> s;</span><br></pre></td></tr></table></figure><p>Python作为解释型语言，变量无需指定类型，赋值即可</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">var_string = <span class="string">&quot;这是字符串变量&quot;</span></span><br><span class="line">var_number = <span class="number">1</span></span><br><span class="line">var_list = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line">var_tuple = (<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>)</span><br><span class="line">var_set = &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;</span><br><span class="line">var_dict = &#123;<span class="string">&quot;key&quot;</span>:<span class="string">&quot;value&quot;</span>&#125;</span><br></pre></td></tr></table></figure><p>上述例子展示了python 六种基本数据类型<br>从中也可以获取关于Python3的几个特点：</p><ul><li>变量的名字符合 <strong>小写字母+下划线+数字</strong> 的组合</li><li>语句末尾不需要分号</li><li>天然支持中文 <em>（准确来说是Unicode编码）</em></li></ul><p>由于Python是动态语言，不同类型的对象可以赋值给同一个变量，如下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="string">&quot;先是字符串&quot;</span></span><br><span class="line">a = <span class="number">1.0</span></span><br></pre></td></tr></table></figure><h3 id="基本数据类型"><a href="#基本数据类型" class="headerlink" title="基本数据类型"></a>基本数据类型</h3><h4 id="数字-Number"><a href="#数字-Number" class="headerlink" title="数字 Number"></a>数字 Number</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Python3 支持 int、float、bool、complex（复数）</span></span><br><span class="line">a = <span class="number">45</span></span><br><span class="line">b = <span class="number">3.0</span></span><br><span class="line">c = <span class="literal">True</span></span><br><span class="line">d = <span class="number">4</span>+<span class="number">7j</span></span><br></pre></td></tr></table></figure><p>上面的<code>#</code>表示单行注释，类似于C的<code>//</code></p><h4 id="字符串-String"><a href="#字符串-String" class="headerlink" title="字符串 String"></a>字符串 String</h4><p>字符串，你可以拿字符数组<code>char[]/char*</code>理解，但是强大的多</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">text1 = <span class="string">&quot;普通字符串&quot;</span></span><br><span class="line">text2 = <span class="string">r&quot;原始字符串，里面是什么就输出什么&quot;</span></span><br><span class="line">text3 = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">多行字符串</span></span><br><span class="line"><span class="string">里面的</span></span><br><span class="line"><span class="string">东西</span></span><br><span class="line"><span class="string">可以换行写</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure><p>要理解<code>r&quot;&quot;</code>，可以参照下面的例子</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">normal = <span class="string">&quot;这是第一行\n这是第二行&#x27;</span></span><br><span class="line"><span class="string">raw = r&quot;</span>这是第一行\n这也是第一行<span class="string">&quot;</span></span><br><span class="line"><span class="string">print(normal) #这是第一行</span></span><br><span class="line"><span class="string">              #这是第二行</span></span><br><span class="line"><span class="string">print(raw)    #这是第一行\n这也是第一行</span></span><br></pre></td></tr></table></figure><p>可以用 <strong>+</strong> 连接两个字符串</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">text = <span class="string">&quot;Hello&quot;</span>+<span class="string">&quot; &quot;</span>+<span class="string">&quot;World!&quot;</span></span><br><span class="line"><span class="built_in">print</span>(text) <span class="comment">#Hello World!</span></span><br></pre></td></tr></table></figure><p>用  <strong>*</strong> 将其重复</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">text = <span class="string">&quot;一部分&quot;</span></span><br><span class="line">text *= <span class="number">3</span></span><br><span class="line"><span class="built_in">print</span>(text) <span class="comment">#自行运行尝试</span></span><br></pre></td></tr></table></figure><h4 id="列表-List"><a href="#列表-List" class="headerlink" title="列表 List"></a>列表 List</h4><p>类似于数组，但具有下面的特性</p><ul><li>长度无限</li><li>里面可以随便装任何类型的对象<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">l = [<span class="number">1</span>,<span class="string">&quot;字符串&quot;</span>,<span class="literal">True</span>]</span><br><span class="line">number = l[<span class="number">0</span>] <span class="comment">#1</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>如果指定的index不存在，则会报错<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">l[<span class="number">3</span>]</span><br><span class="line"><span class="comment"># Traceback (most recent call last):</span></span><br><span class="line"><span class="comment">#   File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;</span></span><br><span class="line"><span class="comment"># IndexError: list index out of range</span></span><br></pre></td></tr></table></figure>可以用 <strong>append</strong> 方法添加一个元素<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">l.append(<span class="string">&quot;新元素&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(l) <span class="comment">#[1, &#x27;字符串&#x27;, True, &#x27;新元素&#x27;]</span></span><br></pre></td></tr></table></figure></li></ul><p><strong>extend</strong>添加多个</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">l.extend([<span class="string">&quot;第一个&quot;</span>,<span class="string">&quot;第二个&quot;</span>])</span><br><span class="line"><span class="built_in">print</span>(l) <span class="comment">#[1, &#x27;字符串&#x27;, True, &#x27;新元素&#x27;, &#x27;第一个&#x27;, &#x27;第二个&#x27;]</span></span><br></pre></td></tr></table></figure><p><strong>pop</strong> 删除某个元素并返回被删的那个</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">l.pop()</span><br><span class="line"><span class="string">&#x27;第二个&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l</span><br><span class="line">[<span class="number">1</span>, <span class="string">&#x27;字符串&#x27;</span>, <span class="literal">True</span>, <span class="string">&#x27;新元素&#x27;</span>, <span class="string">&#x27;第一个&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l.pop(<span class="number">3</span>)</span><br><span class="line"><span class="string">&#x27;新元素&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l</span><br><span class="line">[<span class="number">1</span>, <span class="string">&#x27;字符串&#x27;</span>, <span class="literal">True</span>, <span class="string">&#x27;第一个&#x27;</span>]</span><br></pre></td></tr></table></figure><p>上面的 <code>&gt;&gt;&gt;</code>代表在Python交互式环境中，安装完Python后即可使用</p><p>其余复杂细节之后再讲</p><h4 id="元组-Tuple"><a href="#元组-Tuple" class="headerlink" title="元组 Tuple"></a>元组 Tuple</h4><p>类似于列表，但是长度固定，且内容不可被修改</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt;tuple_test = (<span class="string">&quot;第一个&quot;</span>,<span class="string">&quot;第二个&quot;</span>,<span class="string">&quot;第三个&quot;</span>)</span><br><span class="line">&gt;&gt;&gt;<span class="built_in">print</span>(tuple_test[<span class="number">2</span>])</span><br><span class="line">第三个</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>tuple_test[<span class="number">2</span>] = <span class="string">&quot;试图修改&quot;</span> </span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">TypeError: <span class="string">&#x27;tuple&#x27;</span> <span class="built_in">object</span> does <span class="keyword">not</span> support item assignment</span><br></pre></td></tr></table></figure><p>未完待续</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;从C到Python&quot;&gt;&lt;a href=&quot;#从C到Python&quot; class=&quot;headerlink&quot; title=&quot;从C到Python&quot;&gt;&lt;/a&gt;从C到Python&lt;/h2&gt;&lt;p&gt;本文适合于那些有过一定C语言基础并希望学习Python的人，仅在简明指出二者的过渡。</summary>
      
    
    
    
    <category term="教程" scheme="https://funnysaltyfish.vercel.app/categories/%E6%95%99%E7%A8%8B/"/>
    
    
    <category term="教程" scheme="https://funnysaltyfish.vercel.app/tags/%E6%95%99%E7%A8%8B/"/>
    
    <category term="Python" scheme="https://funnysaltyfish.vercel.app/tags/Python/"/>
    
  </entry>
  
  <entry>
    <title>Flutter卡在Running ‘gradle assembleDebug‘最完整解决</title>
    <link href="https://funnysaltyfish.vercel.app/2021/05/27/flutter-gradle-assembleDebug-fix/"/>
    <id>https://funnysaltyfish.vercel.app/2021/05/27/flutter-gradle-assembleDebug-fix/</id>
    <published>2021-05-27T14:03:41.000Z</published>
    <updated>2021-05-27T14:10:32.831Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>结合csdn+博客园+github+Stack Overflow+自己尝试，解决该问题！<br>今天突发奇想试一下flutter，按照网上教程配置完后（flutter doctor）全部合格，运行却卡在了Running ‘gradle assembleDebug’。打开任务管理器，AS的网络占用相当之低，一会就为0。找了各种方法，最后搞出了这一套<br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20200731124455645.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTk2MDY3,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h2 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h2><ul><li>准备一个可以完成编译和运行的Android项目（项目A）</li><li>打开你的Flutter项目（项目B）</li><li>Flutter的安装目录</li></ul><h2 id="多处修改"><a href="#多处修改" class="headerlink" title="多处修改"></a>多处修改</h2><p>打开A项目的build.gradle，记住里面的gradle版本号<br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20200731124455504.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTk2MDY3,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>继续打开此项目的app/build.gradle，记住如下数据<br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20200731124738217.png" alt="在这里插入图片描述"><br>继续打开此项目的gradle/wrapper/gradle-wrapper.properties,记住最下面的url</p><p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20200731124455515.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTk2MDY3,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>打开B项目<br>修改compile sdk与A相同<br>修改build.gradle，包括如下四个地方<br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20200731124455513.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTk2MDY3,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20200731125121188.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTk2MDY3,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">maven &#123; url <span class="string">&#x27;https://maven.aliyun.com/repository/google&#x27;</span> &#125;</span><br><span class="line">maven &#123; url <span class="string">&#x27;https://maven.aliyun.com/repository/jcenter&#x27;</span> &#125;</span><br><span class="line">maven &#123; url <span class="string">&#x27;http://maven.aliyun.com/nexus/content/groups/public&#x27;</span> &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>（第一处地方请根据Android Studio提示来，没提示就不用改）</p><p>继续打开该项目下的gradle/wrapper/gradle-wrapper.properties，修改url与A项目相同</p><p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20200731124455511.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTk2MDY3,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p>接下来打开<code>Flutter安装目录</code><br>\flutter\packages\flutter_tools\gradle\resolve_dependencies.gradle<br>修改如下<br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20200731124442683.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTk2MDY3,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">maven &#123;</span><br><span class="line">    url <span class="string">&quot;https://storage.flutter-io.cn/download.flutter.io&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>继续打开安装目录下\flutter\packages\flutter_tools\gradle\flutter.gradle<br>修改如下地方<br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/2020073112572950.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTk2MDY3,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>其中第三个地方</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String MAVEN_REPO      = <span class="string">&quot;https://storage.flutter-io.cn/download.flutter.io&quot;</span>;</span><br></pre></td></tr></table></figure><p>修改完成！</p><h2 id="运行命令"><a href="#运行命令" class="headerlink" title="运行命令"></a>运行命令</h2><p>在AS中打开Flutter项目，首先<strong>Tools-flutter-flutter clean</strong><br>完成后，在终端中<strong>分三次输入</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> android</span><br><span class="line">./gradlew clean</span><br><span class="line">./gradlew build</span><br></pre></td></tr></table></figure><p>（上面的命令如果提示 .不是有效命令 ，去除./即可）</p><p>期间会下载一些东西，等待即可<br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20200731130322788.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTk2MDY3,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20200731130322790.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTk2MDY3,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p>完成</p><h2 id="运行项目"><a href="#运行项目" class="headerlink" title="运行项目"></a>运行项目</h2><p>直接debug项目，几秒钟之内完成运行！！！！！！！！</p><p>完结撒花！<br>若对您有帮助，请在评论区回复！！！！！！</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h2&gt;&lt;p&gt;结合csdn+博客园+github+Stack Overflow+自己尝试，解决该问题！&lt;br&gt;今天突发奇想试一下flutter，按照网上教</summary>
      
    
    
    
    <category term="Bug Fix" scheme="https://funnysaltyfish.vercel.app/categories/Bug-Fix/"/>
    
    
    <category term="Flutter" scheme="https://funnysaltyfish.vercel.app/tags/Flutter/"/>
    
    <category term="bug修复" scheme="https://funnysaltyfish.vercel.app/tags/bug%E4%BF%AE%E5%A4%8D/"/>
    
  </entry>
  
  <entry>
    <title>学了python不知干啥？爬爬虫！（7）代理的使用</title>
    <link href="https://funnysaltyfish.vercel.app/2021/05/26/python-spider-lesson-7/"/>
    <id>https://funnysaltyfish.vercel.app/2021/05/26/python-spider-lesson-7/</id>
    <published>2021-05-26T08:53:57.000Z</published>
    <updated>2021-06-14T03:44:14.333Z</updated>
    
    <content type="html"><![CDATA[<p>多线程批量翻译</p><blockquote><p>合理爬取，不恶意扩大站点压力<br>本文章仅作示例，请勿用作非法用途</p></blockquote><hr><p>在Python爬虫过程中，常常会遇见因为各种原因被服务器拒绝访问的情况。有时候设置User-Agent能够解决问题，但如果遇到服务器校验ip访问次数来判断爬虫的情况，这样简单的做法就无能为力了。往往这种时候，采用代理ip间接访问能取得不错的成效。<br>那么，什么是代理呢？</p><hr><h2 id="代理"><a href="#代理" class="headerlink" title="代理"></a>代理</h2><h3 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h3><p>让我们假想这样一个场景，你是一个广告员，负责给一个老奶奶打广告并获拿到她的反馈留言。老奶奶每天见到你很心烦，看见你多次来就不见你了。这时候你想到了另一个办法，你找到老奶奶的儿子孙子外甥侄子……把将自己的广告内容告诉他们，让他们跟老奶奶复述，然后由他们将得到的反馈结果告诉你，从而间接完成自己的目的。当这样的过程中发生在爬虫时，那些爬取过程中的“中间人”，就是代理。</p><h3 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h3><p>常见的HTTP代理分为三个类型，即<strong>透明代理IP、匿名代理IP、高匿名代理IP</strong>，它们的具体区别见下：</p><blockquote><p>1)透明代理(Transparent Proxy)：透明代理虽然可以直接“隐藏”客户端的 IP 地址，但是还是可以从来查到客户端的 IP 地址。</p></blockquote><blockquote><p>2)匿名代理(Anonymous Proxy)：匿名代理能提供隐藏客户端 IP 地址的功能。使用匿名代理，服务器能知道客户端使用用了代理，当无法知道客户端真实 IP 地址。</p></blockquote><blockquote><p>3)高匿代理(Elite Proxy 或 High Anonymity Proxy):高匿代理既能让服务器不清楚客户端是否在使用代理，也能保证服务器获取不到客户端的真实 IP 地址。</p></blockquote><h3 id="代理的选择"><a href="#代理的选择" class="headerlink" title="代理的选择"></a>代理的选择</h3><blockquote><p>普通匿名代理能隐藏客户机的真实 IP，但会改变我们的请求信息，服务器端有可能会认为我们使用了代理。不过使用此种代理时，虽然被访问的网站不能知道客户端的 IP 地址，但仍然可以知道你在使用代理，当然某些能够侦测 IP 的网页仍然可以查到客户端的 IP。<br>而高度匿名代理不改变客户机的请求，这样在服务器看来就像有个真正的客户浏览器在访问它，这时客户的真实IP是隐藏的，服务器端不会认为我们使用了代理。<br>因此，爬虫程序需要使用到代理 IP 时，尽量选择普通匿名代理和高匿名代理。另外，如果要保证数据不被代理服务器知道，推荐使用 HTTPS 协议的代理。</p></blockquote><p>上面的描述未免有些理论化，我们实际使用试一下吧~</p><hr><h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><h3 id="获取代理ip"><a href="#获取代理ip" class="headerlink" title="获取代理ip"></a>获取代理ip</h3><p>在互联网搜索，有大量的服务商提供了代理服务。对于专业性较强、访问要求率较高的场景，建议选择收费服务；在这里只做演示，我们随意选择<a href="https://www.89ip.cn/1">一家代理提供商</a>的免费代理<br>打开页面，能看到如下代理ip列表<br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20210520233829414.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTk2MDY3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><p>由于不是本篇重点，爬取此页面的代理列表对应过程省略，如果不太明白如何爬取，可以我参考之前的文章。<br>编写代码如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_html</span>(<span class="params">url</span>):</span></span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/89.0.4389.90 Safari/537.36 Edg/89.0.774.57&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    html = requests.get(url,headers=headers).text</span><br><span class="line">    <span class="keyword">return</span> html</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_ip_list</span>(<span class="params">url</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        url 代理IP页面</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="comment"># 通用正则匹配的格式是 (IP,端口,地区) 地区有可能包含换行和空格</span></span><br><span class="line">    ip_proxy_re = re.<span class="built_in">compile</span>(</span><br><span class="line">        <span class="string">r&#x27;(\d&#123;1,3&#125;\.\d&#123;1,3&#125;\.\d&#123;1,3&#125;\.\d&#123;1,3&#125;)\s*&lt;/td&gt;\s*&lt;td&gt;\s*(\d&#123;1,&#125;)\s*&lt;/td&gt;\s*&lt;[^\u4E00-\u9FA5]+&gt;([\u4E00-\u9FA5]*\s*[\u4E00-\u9FA5]*\s*[\u4E00-\u9FA5]*)\s*&lt;&#x27;</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        data = get_html(url)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> []</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 返回的IP 就是 正则匹配的结果(IP,端口,地区) 地区有可能包含换行和空格</span></span><br><span class="line">    ip_list = ip_proxy_re.findall(data)</span><br><span class="line">    <span class="keyword">return</span> ip_list</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>上述代码运行的结果为：</p><p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20210520233919729.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTk2MDY3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>输出的每一项结果包含 ip地址、端口、地区</p><h3 id="使用-1"><a href="#使用-1" class="headerlink" title="使用"></a>使用</h3><p>有了代理ip，接下来就是使用了。requests库提供了很方便的办法：仅需要在对应请求中加入 <strong>proxies</strong> 参数即可：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_with_ip</span>(<span class="params">url:<span class="built_in">str</span>,ip:<span class="built_in">str</span></span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;带ip访问，其中ip形如 127.0.0.1:8080</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/89.0.4389.90 Safari/537.36 Edg/89.0.774.57&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    proxies = &#123;<span class="string">&quot;http&quot;</span>:ip&#125;</span><br><span class="line">    <span class="keyword">return</span> requests.get(url,headers=headers,proxies=proxies)</span><br></pre></td></tr></table></figure><h3 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h3><p>如何才能知道是不是真的在用代理ip访问而不是自己的ip在访问呢？我们可以采取如下办法：<br>访问一个<strong>查看ip的网址</strong>，然后获取<strong>网址得到的访问ip</strong>，进行验证即可<br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20210521000541304.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTk2MDY3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><p>编写代码如下。</p><h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><p>将上述过程结合起来，我们写出了下面的代码。代码首先获取ip列表，并在之后尝试使用这些ip访问网址。值得注意的是，因为获取到的免费代理<strong>不一定稳定</strong>，代码中添加了<strong>超时和错误处理</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    代理ip使用</span></span><br><span class="line"><span class="string">    文章列表见 https://blog.csdn.net/qq_43596067/article/details/117003258</span></span><br><span class="line"><span class="string">    请注意，由于代理ip质量和时效不稳定，此份代码不一定保证能够运行，请酌情修改</span></span><br><span class="line"><span class="string">    @copyright : FunnySaltyFish</span></span><br><span class="line"><span class="string">    @date : 2021/05/20 23:22:11</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> pprint</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_html</span>(<span class="params">url</span>):</span></span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/89.0.4389.90 Safari/537.36 Edg/89.0.774.57&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    html = requests.get(url,headers=headers).text</span><br><span class="line">    <span class="keyword">return</span> html</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_ip_list</span>(<span class="params">url</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        url 代理IP页面</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="comment"># 通用正则匹配的格式是 (IP,端口,地区) 地区有可能包含换行和空格</span></span><br><span class="line">    ip_proxy_re = re.<span class="built_in">compile</span>(</span><br><span class="line">        <span class="string">r&#x27;(\d&#123;1,3&#125;\.\d&#123;1,3&#125;\.\d&#123;1,3&#125;\.\d&#123;1,3&#125;)\s*&lt;/td&gt;\s*&lt;td&gt;\s*(\d&#123;1,&#125;)\s*&lt;/td&gt;\s*&lt;[^\u4E00-\u9FA5]+&gt;([\u4E00-\u9FA5]*\s*[\u4E00-\u9FA5]*\s*[\u4E00-\u9FA5]*)\s*&lt;&#x27;</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        data = get_html(url)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;获取ip列表时发生错误，原因是：<span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> []</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 返回的IP 就是 正则匹配的结果(IP,端口,地区) 地区有可能包含换行和空格</span></span><br><span class="line">    ip_list = ip_proxy_re.findall(data)</span><br><span class="line">    <span class="keyword">return</span> ip_list</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_with_ip</span>(<span class="params">url:<span class="built_in">str</span>,ip:<span class="built_in">str</span></span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;带ip访问，其中ip形如 127.0.0.1:8080</span></span><br><span class="line"><span class="string">        访问错误时返回&quot;&quot;</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/89.0.4389.90 Safari/537.36 Edg/89.0.774.57&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    proxies = &#123;</span><br><span class="line">        <span class="string">&quot;http&quot;</span>:ip,</span><br><span class="line">        <span class="string">&quot;https&quot;</span>:ip,</span><br><span class="line">    &#125;</span><br><span class="line">    html = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        html = requests.get(url,headers=headers,proxies=proxies,timeout=<span class="number">10</span>).text</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;访问错误！原因是：<span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> html</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">validate</span>(<span class="params">ip</span>):</span></span><br><span class="line">    html = get_with_ip(</span><br><span class="line">        <span class="string">&quot;https://ip.tool.chinaz.com/&quot;</span>,</span><br><span class="line">        ip</span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">if</span> html == <span class="string">&quot;&quot;</span>: <span class="comment">#访问错误</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    pattern = re.<span class="built_in">compile</span>(<span class="string">&quot;域名(.+)的信息&quot;</span>)</span><br><span class="line">    match = pattern.search(html)</span><br><span class="line">    <span class="keyword">if</span> match <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">return</span> match.group(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    ip_list = get_ip_list(<span class="string">&quot;https://www.89ip.cn/1&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;获取到的ip列表为：&quot;</span>)</span><br><span class="line">    pprint.pprint(ip_list)</span><br><span class="line">    <span class="keyword">for</span> each <span class="keyword">in</span> ip_list:</span><br><span class="line">        ip = <span class="string">f&quot;<span class="subst">&#123;each[<span class="number">0</span>]&#125;</span>:<span class="subst">&#123;each[<span class="number">1</span>]&#125;</span>&quot;</span> <span class="comment"># 拼接ip和端口</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;尝试使用ip[<span class="subst">&#123;ip&#125;</span>]访问……&quot;</span>)</span><br><span class="line">        shown_ip = validate(ip)</span><br><span class="line">        <span class="keyword">if</span> shown_ip != <span class="string">&quot;&quot;</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;采用的ip地址是：<span class="subst">&#123;ip&#125;</span> 爬取后网站显示的ip地址是：<span class="subst">&#123;shown_ip&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure><p><strong>【请注意，由于代理ip质量和时效不稳定，此份代码不一定保证能够运行，请酌情修改】</strong><br>下面是笔者测试时的运行情况：<br>–部分访问错误：<br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20210521171431849.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTk2MDY3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>–部分访问成功<br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20210521171431820.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTk2MDY3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20210521171431779.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTk2MDY3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul><li>爬虫所使用的的HTTP代理是什么？<a href="https://blog.csdn.net/yingpu618/article/details/107820814">https://blog.csdn.net/yingpu618/article/details/107820814</a></li></ul><h2 id="后续"><a href="#后续" class="headerlink" title="后续"></a>后续</h2><ul><li><a href="/2021/05/26/python-spider-lesson-catalog/">系列文章完整目录</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;多线程批量翻译&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;合理爬取，不恶意扩大站点压力&lt;br&gt;本文章仅作示例，请勿用作非法用途&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;p&gt;在Python爬虫过程中，常常会遇见因为各种原因被服务器拒绝访问的情况。有时候设置User-Ag</summary>
      
    
    
    
    <category term="Python爬虫教程" scheme="https://funnysaltyfish.vercel.app/categories/Python%E7%88%AC%E8%99%AB%E6%95%99%E7%A8%8B/"/>
    
    
    <category term="Python" scheme="https://funnysaltyfish.vercel.app/tags/Python/"/>
    
    <category term="爬虫" scheme="https://funnysaltyfish.vercel.app/tags/%E7%88%AC%E8%99%AB/"/>
    
  </entry>
  
  <entry>
    <title>学了python不知干啥？爬爬虫！（6）爱词霸翻译（内容详尽，从打开网页手把手完成JS逆向并写出代码）</title>
    <link href="https://funnysaltyfish.vercel.app/2021/05/26/python-spider-lesson-6/"/>
    <id>https://funnysaltyfish.vercel.app/2021/05/26/python-spider-lesson-6/</id>
    <published>2021-05-26T08:51:21.000Z</published>
    <updated>2021-06-14T03:43:41.767Z</updated>
    
    <content type="html"><![CDATA[<p>多线程批量翻译</p><blockquote><p>合理爬取，不恶意扩大站点压力<br>本文章仅作示例，请勿用作非法用途</p></blockquote><hr><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>&emsp;&emsp;前几篇教程的爬取，我们一直局限于静态网站，且请求仅限于get。但在实际的开发过程中，动态内容才往往是爬取的核心。在本节内容中，我将带你一步步分析<a href="https://www.iciba.com/">爱词霸</a>的翻译结果获取过程，并伪装请求实现单词翻译。<br>&emsp;&emsp;本篇内容为本人原创，转载请注明！<br>&emsp;&emsp;请注意，<strong>本篇内容仅限于学习交流，切勿用于商业用途！</strong><br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20210417210225461.png#pic_center" alt="结果"></p><hr><h2 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h2><h3 id="网络加载过程"><a href="#网络加载过程" class="headerlink" title="网络加载过程"></a>网络加载过程</h3><p>&emsp;&emsp;首先打开<a href="https://www.iciba.com/fy">爱词霸</a>，并使用 F12 打开开发者工具 <small><em>【此处使用浏览器为Edge，如使用其他浏览器请参照对应教程打开此界面】</em> </small> 。<img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20210417162427533.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTk2MDY3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>为了动态分析翻译过程，我们需要切换到 <strong>网络(Network)</strong> 标签页<br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/2021041716255944.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTk2MDY3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>输入任意单词，点击翻译按钮，你将会看到如下请求结果：<br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20210417171652787.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTk2MDY3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><p>这就是动态翻译的请求。在此条请求上<strong>右键-复制链接地址</strong><br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20210417171850950.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTk2MDY3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>得到如下结果</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://ifanyi.iciba.com/index.php?c=trans&amp;m=fy&amp;client=6&amp;auth_user=key_ciba&amp;sign=0020c1fc11e96d3a</span><br></pre></td></tr></table></figure><p>目前的链接有许多参数尚未明确，我们先留着，之后再做分析。<br>切换到预览标签页并展开结果，我们惊喜地发现，翻译结果就藏在对应的<strong>json</strong>中。<br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20210417172006899.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTk2MDY3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20210417172006903.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTk2MDY3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>&emsp;&emsp;目标就是模拟这个请求，那么下一步我们需要弄清楚这里面的参数究竟各代表什么。<br>&emsp;&emsp;切换到标头页，在这里我们可以查看详细的请求头</p><p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20210417172236684.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTk2MDY3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>&emsp;&emsp;可以看到，除了明显的get请求外，该请求还携带有表单参数。分析字段不难发现，post的表单带有此次翻译的单词信息。其中，<strong>from和to分别是源语言和目标语言，q即为翻译的单词</strong>。<br>&emsp;&emsp;我们需要弄清楚其他参数是什么意思。此处采用对比的方法。<br>&emsp;&emsp;再次翻译另一个单词，得到第二组请求地址和请求头</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://ifanyi.iciba.com/index.php?c=trans&amp;m=fy&amp;client=6&amp;auth_user=key_ciba&amp;sign=09467500f66fb4a7</span><br></pre></td></tr></table></figure><p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20210417172236750.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTk2MDY3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>&emsp;&emsp;上下对比可知，两次请求的url中，仅有<strong>sign</strong>参数发生改变。可以猜测正是此参数起到加密作用。下一步我们就需要搞清楚，这个参数是怎么来的。<br>&emsp;&emsp;我们进入重头戏：<strong>源码分析！</strong></p><hr><h3 id="JS源码分析"><a href="#JS源码分析" class="headerlink" title="JS源码分析"></a>JS源码分析</h3><p>&emsp;&emsp;现在我们的目标是找sign，那么最直白的思路就很显然了：看看源代码那些地方出现了”sign”，那些就是比较可疑的地方。<br>&emsp;&emsp;切换到<strong>源代码</strong>标签，使用快捷键<strong>Ctrl+Shift+F</strong>或按下图找到<strong>全局搜索</strong>面板<br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20210417173210828.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTk2MDY3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述">先尝试一下直接搜索sign<br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20210417173319380.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTk2MDY3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>得到了9个结果，先进入第一个排查。<br>使用“优质打印”格式化代码以便于后面的分析。<br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20210417173436554.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTk2MDY3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><p>使用<strong>Ctrl+F</strong>打开页内搜索，尝试查找“sign”<br>但是结果很不理想，有相当大的一部分是关于assign的，不利于结果的分析。<br>我们大概推测，sign在代码执行过程中应该是某个对象的参数。因此改用”\.sign”重新搜索<br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20210417173720868.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTk2MDY3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>逐个排查，发现这几个<strong>signature</strong>有较大概率是我们的目标。<br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20210417173829502.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTk2MDY3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>是不是呢？验证一下就知道了。<br>在源代码左侧的行号旁单击鼠标打上断点，程序就会在运行到此处时暂停。<br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20210417182814797.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTk2MDY3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>重新点击翻译按钮，得到运行结果<br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20210417182839959.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTk2MDY3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>观察上图，从变量的值我们可以看到，在这行代码执行前就已经产生了sign<br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20210417182936815.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTk2MDY3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>&emsp;&emsp;不难看出，变量<strong>r</strong>可能就是封装好的请求内容，而<strong>e</strong>则是对应链接。<br>&emsp;&emsp;那么我们的关注点就在<strong>变量e</strong>上，而变量e已经带有了对应的sign。于是我们从旁边的<strong>调用堆栈</strong>标签找到在断点执行位置的上一处，观察此处的代码和变量值<br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20210417183235511.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTk2MDY3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20210417183444428.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTk2MDY3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20210417183444406.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTk2MDY3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br><strong>变量r</strong>的值引起了我们的注意，这一串字符非常符合刚刚看到的<strong>sign</strong>的特征。究竟是不是，我们让代码恢复执行，看看结果。<br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20210417183627965.png#pic_center" alt="在这里插入图片描述"><br>最终的请求url中的<strong>sign</strong>参数正是此处的<strong>r</strong>！<br>于是为<strong>r</strong>赋值的这一行代码就非常重要了，摘录如下：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">takeResult: <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">var</span> t = p.a.parse(e)</span><br><span class="line">                  , r = c()(<span class="string">&quot;6key_cibaifanyicjbysdlove1&quot;</span>.concat(t.q.replace(<span class="regexp">/(^\s*)|(\s*$)/g</span>, <span class="string">&quot;&quot;</span>))).toString().substring(<span class="number">0</span>, <span class="number">16</span>);</span><br><span class="line">                <span class="keyword">return</span> g(<span class="string">&quot;/index.php?c=trans&amp;m=fy&amp;client=6&amp;auth_user=key_ciba&amp;sign=&quot;</span>.concat(r), &#123;</span><br><span class="line">                    <span class="attr">baseURL</span>: <span class="string">&quot;//ifanyi.iciba.com&quot;</span>,</span><br><span class="line">                    <span class="attr">method</span>: <span class="string">&quot;post&quot;</span>,</span><br><span class="line">                    <span class="attr">headers</span>: &#123;</span><br><span class="line">                        <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/x-www-form-urlencoded&quot;</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="attr">data</span>: e</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;,</span><br></pre></td></tr></table></figure><p>&emsp;&emsp;从这里的js代码可得知，<strong>r</strong>是调用<strong>c()函数</strong>得到的结果，传入的参数是一个固定字符串 <code>“6key_cibaifanyicjbysdlove1”</code> 再拼接上翻译的单词，之后调用 <code>replace(/(^\s*)|(\s*$)/g, &quot;&quot;))</code> 的结果。下一步就是看看，这个c()究竟是个什么东西？<br>&emsp;&emsp;切换标签为<strong>控制台</strong>页，输入c()<br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20210417184359353.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTk2MDY3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>发现它返回的是一个函数，点击上面的输出结果，可以跳转到对应的源代码位置<br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20210417184442573.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTk2MDY3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>&emsp;&emsp;这是一个陌生的函数。进行到这一步，让我们回顾一下，我们输入的参数是明文，出来的却是英文字符组成的字符串。我们可以猜测，此处的函数作用就是对参数进行某种加密或哈希算法。<br>&emsp;&emsp;翻阅这个js文件，可以发现大量的<strong>位运算</strong>操作，这正是加密中常用的操作。因此我们可以就此猜测，这个文件就是一个库文件，功能就是实现常见的字符串加密算法。<br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/2021041718495455.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTk2MDY3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><p>到这里思路换了个方向。我们不妨暂时跳出分析代码的过程，看看JS中有没有这样的库存在。<br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20210417185037435.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTk2MDY3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>搜索的结果几乎全部指向了<strong>CryptoJS</strong>这个第三方库，那我们去Github看看它的源代码<br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20210417185137656.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTk2MDY3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>尝试搜索刚刚代码中出现的 <code>_createHelper</code> 字段。<br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/2021041718524599.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTk2MDY3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>在 <code>core.js</code> 下，我们发现了这一段：<br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20210417185313782.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTk2MDY3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>与刚才的<br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20210417185332876.png#pic_center" alt="在这里插入图片描述"><br>一模一样！！！</p><h3 id="寻找具体算法"><a href="#寻找具体算法" class="headerlink" title="寻找具体算法"></a>寻找具体算法</h3><p>简单搜索得知，<strong>CryptoJS</strong>提供了种类丰富的加密算法。要找到此处用的是哪一种就有很多办法。这里我们选择：<strong>黑箱理论</strong>。</p><blockquote><p>黑箱理论，是指对特定的系统开展研究时，人们把系统作为一个看不透的黑色箱子，研究中不涉及系统内部的结构和相互关系，仅从其输入输出的特点了解该系统规律，用黑箱方法得到的对一个系统规律的认识。</p></blockquote><p>寻找一个特定的输入：<br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20210417185757621.png#pic_center" alt="在这里插入图片描述"><br>在调试模式下选中生成参数的部分代码，就可以看到此次运行的结果<br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20210417185813154.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTk2MDY3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>上面这一次的运行结果如下：<br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20210417200408602.png#pic_center" alt="在这里插入图片描述"></p><p>随便打开一个用于加密的<a href="http://encode.chahuo.com/">网站</a>，经过不断尝试，在尝试到<strong>MD5</strong>的时候，得到了一模一样的结果：<br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20210417200430587.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTk2MDY3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">18dc7242de5f73cae3b299a6c8eba326</span><br></pre></td></tr></table></figure><p>如此就确定了加密方式：<strong>MD5！</strong><br>一切就绪，下一步自然就是编写代码啦！开干！</p><h3 id="代码编写"><a href="#代码编写" class="headerlink" title="代码编写"></a>代码编写</h3><p>上面分析得很到位了，每一个参数都给了详尽的解释，此处就不再赘述。参见代码和注释即可。</p><h2 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    爱词霸 单词翻译。仅用于学习与交流</span></span><br><span class="line"><span class="string">    @copyright : FunnySaltyFish</span></span><br><span class="line"><span class="string">    @date : 2021/04/17 20:38:45</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_result</span>(<span class="params">word,source=<span class="string">&quot;zh&quot;</span>,to=<span class="string">&quot;en&quot;</span></span>):</span></span><br><span class="line">    <span class="comment"># 伪装请求头</span></span><br><span class="line">    <span class="comment"># 不知道为什么要有这一行的可以看 https://blog.csdn.net/qq_43596067/article/details/105889267</span></span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">&quot;User-Agent&quot;</span>:<span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/89.0.4389.90 Safari/537.36 Edg/89.0.774.57&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment"># 计算sign参数</span></span><br><span class="line">    sign = get_signature(word)[<span class="number">0</span>:<span class="number">16</span>]</span><br><span class="line">    <span class="comment"># 组装url</span></span><br><span class="line">    url = <span class="string">f&quot;https://ifanyi.iciba.com/index.php?c=trans&amp;m=fy&amp;client=6&amp;auth_user=key_ciba&amp;sign=<span class="subst">&#123;sign&#125;</span>&quot;</span></span><br><span class="line">    <span class="comment"># post表单 数据</span></span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&quot;from&quot;</span>:source,</span><br><span class="line">        <span class="string">&quot;to&quot;</span>:to,</span><br><span class="line">        <span class="string">&quot;q&quot;</span>:word</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment"># 获得的json文本</span></span><br><span class="line">    result = requests.post(url=url,headers=headers,data=data)</span><br><span class="line">    <span class="keyword">return</span> result.text</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_signature</span>(<span class="params">word:<span class="built_in">str</span></span>):</span></span><br><span class="line">    <span class="comment"># 按js代码写出来的拼接字符串</span></span><br><span class="line">    raw = <span class="string">&quot;6key_cibaifanyicjbysdlove1&quot;</span>+word.replace(<span class="string">r&quot;(^\s*)|(\s*$)&quot;</span>,<span class="string">&quot;&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> md5(raw.encode(<span class="string">&quot;utf-8&quot;</span>)).hexdigest()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">parse_json</span>(<span class="params">text</span>):</span></span><br><span class="line">    <span class="comment"># 简单解析获得翻译结果</span></span><br><span class="line">    <span class="comment"># 针对其他一些翻译结果 ， 您可以自行修改</span></span><br><span class="line">    result = json.loads(text)</span><br><span class="line">    <span class="keyword">return</span> result[<span class="string">&quot;content&quot;</span>][<span class="string">&quot;out&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    word = <span class="string">&quot;你好&quot;</span></span><br><span class="line">    raw = get_result(word)</span><br><span class="line">    translation = parse_json(raw)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;【<span class="subst">&#123;word&#125;</span>】的翻译结果是【<span class="subst">&#123;translation&#125;</span>】&quot;</span>)</span><br></pre></td></tr></table></figure><center>✿✿ヽ(°▽°)ノ✿  完结撒花  ✿✿ヽ(°▽°)ノ✿</center><center><a href="/2021/05/26/python-spider-lesson-catalog">回到目录</a></center>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;多线程批量翻译&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;合理爬取，不恶意扩大站点压力&lt;br&gt;本文章仅作示例，请勿用作非法用途&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=</summary>
      
    
    
    
    <category term="Python爬虫教程" scheme="https://funnysaltyfish.vercel.app/categories/Python%E7%88%AC%E8%99%AB%E6%95%99%E7%A8%8B/"/>
    
    
    <category term="Python" scheme="https://funnysaltyfish.vercel.app/tags/Python/"/>
    
    <category term="爬虫" scheme="https://funnysaltyfish.vercel.app/tags/%E7%88%AC%E8%99%AB/"/>
    
  </entry>
  
  <entry>
    <title>学了python不知干啥？爬爬虫！（5）requests库的使用+错误处理</title>
    <link href="https://funnysaltyfish.vercel.app/2021/05/26/python-spider-lesson-5/"/>
    <id>https://funnysaltyfish.vercel.app/2021/05/26/python-spider-lesson-5/</id>
    <published>2021-05-26T08:49:12.000Z</published>
    <updated>2021-06-14T03:41:44.833Z</updated>
    
    <content type="html"><![CDATA[<p>多线程批量翻译</p><blockquote><p>合理爬取，不恶意扩大站点压力<br>本文章仅作示例，请勿用作非法用途</p></blockquote><hr><p><strong>本篇并没有完成实际项目，而是讲述更加普遍化的处理方式。如果只是希望复制粘贴的，现在可以选择离开了</strong></p><hr><h2 id="Requests初探"><a href="#Requests初探" class="headerlink" title="Requests初探"></a>Requests初探</h2><p>&emsp;&emsp;在前几次的爬虫中，我们一直使用urllib来完成需求；今天我们尝试一个新的第三方库：<em>requests</em><br>&emsp;&emsp;在它的<a href="https://requests.readthedocs.io/zh_CN/latest/index.html">官网</a>中，对它有如下介绍</p><blockquote><p>Requests 完全满足今日 web 的需求。<br>Keep-Alive &amp; 连接池<br>国际化域名和 URL<br>带持久 Cookie 的会话<br>浏览器式的 SSL 认证<br>自动内容解码<br>基本/摘要式的身份认证<br>优雅的 key/value Cookie<br>自动解压<br>Unicode 响应体<br>HTTP(S) 代理支持<br>文件分块上传<br>流下载<br>连接超时<br>分块请求<br>支持 .netrc</p></blockquote><p>不需要全部看懂，总之只需要知道：很强、很易用就对了！</p><ul><li>要学习requests库的基本用法，您可以点击<a href="https://requests.readthedocs.io/zh_CN/latest/user/quickstart.html#id2">这里</a>来查看官方文档*</li></ul><h3 id="小试身手"><a href="#小试身手" class="headerlink" title="小试身手"></a>小试身手</h3><p>最近2077很火，我们就去贴凑个热闹，看看大家对他的讨论<br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20210107172127408.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTk2MDY3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><p><a href="http://jump2.bdimg.com/f?ie=utf-8&kw=%E8%B5%9B%E5%8D%9A%E6%9C%8B%E5%85%8B2077">这里</a>就是本次我们要爬取的目标啦</p><p>使用之前要用pip安装</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install requests</span><br></pre></td></tr></table></figure><p>先写一个最简单的get请求看一看？</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_html</span>(<span class="params">url</span>):</span></span><br><span class="line">    response = requests.get(url)</span><br><span class="line">    <span class="keyword">return</span> response.text</span><br><span class="line"></span><br><span class="line">basic_html = get_html(<span class="string">&quot;https://tieba.baidu.com/f?kw=%E8%B5%9B%E5%8D%9A%E6%9C%8B%E5%85%8B2077&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(basic_html)</span><br></pre></td></tr></table></figure><p>从上面的代码不难发现，使用requests请求非常简单。事实上，对于常见的请求类型，requests都提供了简单的方法</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>r = requests.put(<span class="string">&#x27;http://httpbin.org/put&#x27;</span>, data = &#123;<span class="string">&#x27;key&#x27;</span>:<span class="string">&#x27;value&#x27;</span>&#125;)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>r = requests.delete(<span class="string">&#x27;http://httpbin.org/delete&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>r = requests.head(<span class="string">&#x27;http://httpbin.org/get&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>r = requests.options(<span class="string">&#x27;http://httpbin.org/get&#x27;</span>)</span><br></pre></td></tr></table></figure><p>&emsp;&emsp;接下来，通过使用.text方法，我们可以直接获取到对应源代码，requests会自动根据内容推断对应编码并完成转换的过程。<br>&emsp;&emsp;当然，如果你希望手动指定编码，也是可以的</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">response.encoding = <span class="string">&#x27;ISO-8859-1&#x27;</span> <span class="comment">#手动更改编码</span></span><br></pre></td></tr></table></figure><p>那么这样是否就可以获取到我们想要的内容了呢？答案很残酷：NO！<br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20210107154306563.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTk2MDY3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>&emsp;&emsp;既然简单的不行，那么加点请求头试试看？<br>&emsp;&emsp;在requests中，加入请求头的方法也十分简洁，只需要设置headers参数即可<br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20210107155537781.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTk2MDY3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>但这个时候报了一个很奇怪的错<br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20210107155554943.png#pic_center" alt="在这里插入图片描述"><br>查了查，发现是Cookie里面有拉丁文字符<br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/2021010716081255.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTk2MDY3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><p>把它删了后，再爬一次<br><del>当当当当！</del><br><del>依然获取不到 ~<br><small><em>（按理说百度贴吧应该是个静态页面，而且比较容易获取到，进行到这一步的时候我也很绝望，看来是升级了……）</em><small/></del> </p><p>&emsp;&emsp;当你print结果的时候，你会发现输出并没有你所需要的；但是，当你将结果写入文本再打开时，你才能看见全貌<br><em>（cao！！！）</em><br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20210107163520737.png#pic_center" alt="在这里插入图片描述"><br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20210107163601594.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTk2MDY3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>既然爬取到了，那么就可以进行后续的解析和保存工作了。这一部分前面已经讲过不少，这次就不赘述了。<br>而这次我们要关心的，是爬取的过程，是否已经完美无缺了？答案很显然，不是。</p><h2 id="异常处理"><a href="#异常处理" class="headerlink" title="异常处理"></a>异常处理</h2><h3 id="HTTP状态码"><a href="#HTTP状态码" class="headerlink" title="HTTP状态码"></a>HTTP状态码</h3><p>&emsp;&emsp;让我们回到这个response<br>&emsp;&emsp;Response有一个属性：<code>status_code</code>，用来告诉你这次访问的情况，如果一切顺利，那么它的值会是200，就像下面这样<br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20210107164315210.png#pic_center" alt="在这里插入图片描述"></p><p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20210107164322177.png#pic_center" alt="在这里插入图片描述"><br>&emsp;&emsp;在以往的教程中，我们一直假定一切安好，而没有考虑过不安好的情况。这在一个完备的爬虫程序中，很明显是不可取的。那么接下来，我们就要好好考虑一下了。</p><p>什么是HTTP状态码呢？</p><blockquote><p>当浏览者访问一个网页时，浏览者的浏览器会向网页所在服务器发出请求。当浏览器接收并显示网页前，此网页所在的服务器会返回一个包含HTTP状态码的信息头（server header）用以响应浏览器的请求。</p></blockquote><blockquote><p>下面是常见的HTTP状态码：<br>-200 - 请求成功<br>-301 - 资源（网页等）被永久转移到其它URL<br>-404 - 请求的资源（网页等）不存在<br>-500 - 内部服务器错误</p></blockquote><p>如果发送了一个错误请求(一个 4XX 客户端错误，或者 5XX 服务器错误响应)，我们可以通过 Response.raise_for_status() 来抛出异常：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>bad_r = requests.get(<span class="string">&#x27;http://httpbin.org/status/404&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>bad_r.status_code</span><br><span class="line"><span class="number">404</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>bad_r.raise_for_status()</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;requests/models.py&quot;</span>, line <span class="number">832</span>, <span class="keyword">in</span> raise_for_status</span><br><span class="line">    <span class="keyword">raise</span> http_error</span><br><span class="line">requests.exceptions.HTTPError: <span class="number">404</span> Client Error</span><br></pre></td></tr></table></figure><p>而当其为200时，调用该方法则什么也不会发生</p><h3 id="请求时间"><a href="#请求时间" class="headerlink" title="请求时间"></a>请求时间</h3><p>&emsp;&emsp;另一个值得注意的点是请求时间，对于大批量爬虫，如果因为服务器问题让部分爬虫长时间未得到响应而使主程序一直僵持，产生的结果是难以预料的。所以，应当有必要设置一个阈值，使得链接在超过这个时间仍然没有响应后自动断开。<br>&emsp;&emsp;对应的方法，是设置timeout</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>requests.get(<span class="string">&#x27;http://github.com&#x27;</span>, timeout=<span class="number">0.001</span>)</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">requests.exceptions.Timeout: HTTPConnectionPool(host=<span class="string">&#x27;github.com&#x27;</span>, port=<span class="number">80</span>): Request timed out. (timeout=<span class="number">0.001</span>)</span><br></pre></td></tr></table></figure><p>此处设置的timeout为0.001秒，以模拟超时连接时发生错误的情况；实际项目中，应该按需要设置</p><blockquote><p>注意<br>timeout 仅对连接过程有效，与响应体的下载无关。 timeout 并不是整个下载响应的时间限制，而是如果服务器在 timeout 秒内没有应答，将会引发一个异常（更精确地说，是在 timeout 秒内没有从基础套接字上接收到任何字节的数据时）</p></blockquote><p>在考虑了上述的因素之后，我们的代码应该写成:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> requests <span class="keyword">import</span> exceptions</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_html</span>(<span class="params">url</span>):</span></span><br><span class="line">    html = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        headers = &#123;</span><br><span class="line">            <span class="string">&quot;User-Agent&quot;</span>:<span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.88 Safari/537.36 Edg/87.0.664.60&quot;</span>,</span><br><span class="line">        &#125;</span><br><span class="line">        response = requests.get(url,headers=headers,timeout=<span class="number">5</span>)</span><br><span class="line">        response.raise_for_status()</span><br><span class="line">    <span class="keyword">except</span> exceptions.HTTPError <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;发生HTTP错误，原因是：&quot;</span>,e,sep=<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">    <span class="keyword">except</span> exceptions.Timeout <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;访问超时，原因是：&quot;</span>,e,sep=<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;未知错误，原因是：&quot;</span>,e,sep=<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        html = response.text</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        <span class="keyword">return</span> html</span><br><span class="line"></span><br><span class="line">basic_html = get_html(<span class="string">&quot;https://tieba.baidu.com/f?kw=%E8%B5%9B%E5%8D%9A%E6%9C%8B%E5%85%8B2077&amp;ie=utf-8&amp;pn=50&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> basic_html != <span class="string">&quot;&quot;</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;访问成功&quot;</span>)</span><br></pre></td></tr></table></figure><p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20210107171355113.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTk2MDY3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>这样，程序才会有良好的健壮性。</p><h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><ul><li>我的水平不高，所讲之处难免有所漏洞，还望指正</li><li><a href="/2021/05/26/python-spider-lesson-catalog/">系列文章完整目录</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;多线程批量翻译&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;合理爬取，不恶意扩大站点压力&lt;br&gt;本文章仅作示例，请勿用作非法用途&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;p&gt;&lt;strong&gt;本篇并没有完成实际项目，而是讲述更加普遍化的处理方式。如果只是希望复制粘贴的，现</summary>
      
    
    
    
    <category term="Python爬虫教程" scheme="https://funnysaltyfish.vercel.app/categories/Python%E7%88%AC%E8%99%AB%E6%95%99%E7%A8%8B/"/>
    
    
    <category term="Python" scheme="https://funnysaltyfish.vercel.app/tags/Python/"/>
    
    <category term="爬虫" scheme="https://funnysaltyfish.vercel.app/tags/%E7%88%AC%E8%99%AB/"/>
    
  </entry>
  
  <entry>
    <title>学了python不知干啥？爬爬虫！ （4）多线程爬取</title>
    <link href="https://funnysaltyfish.vercel.app/2021/05/26/python-spider-lesson-4/"/>
    <id>https://funnysaltyfish.vercel.app/2021/05/26/python-spider-lesson-4/</id>
    <published>2021-05-26T08:46:37.000Z</published>
    <updated>2021-06-14T03:41:03.080Z</updated>
    
    <content type="html"><![CDATA[<p>多线程批量翻译</p><blockquote><p>合理爬取，不恶意扩大站点压力<br>本文章仅作示例，请勿用作非法用途</p></blockquote><hr><h2 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h2><p> <img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20200916184305737.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTk2MDY3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><h2 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h2><p> 自己的<a href="http://www.coolapk.com/apk/254263">项目</a>需要一个功能，要求有大量的中英对照翻译，中文词很好找，网上随便搜一下就有了<br> <img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20200916184419733.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTk2MDY3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>但是英文翻译呢？<br>手动翻译自然可以，但身为程序猿，用代码实现不是更加优雅吗？<br>开干！</p><h2 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h2><p>经过梳理后，我们可以把整个过程分为以下几个步骤：</p><ol><li>加载xlsx文件，解析为中文词的列表（元组）</li><li>一一翻译，将结果储存在一个字典中</li><li>保存为json文本</li></ol><h2 id="开始"><a href="#开始" class="headerlink" title="开始"></a>开始</h2><h3 id="加载xlsx"><a href="#加载xlsx" class="headerlink" title="加载xlsx"></a>加载xlsx</h3><p>由于不是本篇重点，直接上代码好了</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取原始数据</span></span><br><span class="line">   xls = xlrd.open_workbook(<span class="string">&quot;D:/Downloads/7000hanzi.xlsx&quot;</span>)</span><br><span class="line">   sheet = xls.sheet_by_index(<span class="number">0</span>)</span><br><span class="line">   col = sheet.col_values(<span class="number">1</span>)</span><br><span class="line">   col.pop(<span class="number">0</span>) <span class="comment">#剔除表头数据</span></span><br></pre></td></tr></table></figure><h3 id="爬取翻译"><a href="#爬取翻译" class="headerlink" title="爬取翻译"></a>爬取翻译</h3><h4 id="旧方法"><a href="#旧方法" class="headerlink" title="旧方法"></a>旧方法</h4><p>如果按照之前的方法，只需要遍历一下列表，然后一个一个翻译就好了。<br>但是！这个效率问题值得我们考虑。<br>假设翻译一个单词需要1s，连续翻译7000个也就要7000s；换句话说，将近两个小时！<img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9zczAuYmRzdGF0aWMuY29tLzcwY0Z1SFNoX1ExWW54R2twb1dLMUhGNmhoeS9pdC91PTI3NzgyNjQ2NTMsMTAyNDI4NjMyMSZmbT0yNiZncD0wLmpwZw?x-oss-process=image/format,png#pic_center" alt="在这里插入图片描述"><br>这时候，就需要多线程出场了！</p><h4 id="新思路"><a href="#新思路" class="headerlink" title="新思路"></a>新思路</h4><p>使用多线程有什么好处呢？</p><blockquote><p>假设现在你面前有一个桌子，上面放着一堆苹果，有很多人等待着吃苹果。<br>规则是每次每人只能拿一个苹果，且拿到苹果的人吃完之后其他人才能拿下一个。<br>我们现在来看一看两种不同情况</p></blockquote><blockquote><p>单线程：由于吃苹果是一个很耗时间的过程，于是你的面前出现了一条长龙，每个人都在干巴巴的等着那个吃苹果的人，眼巴巴的看着他吃完苹果再换人。</p></blockquote><blockquote><p>多线程：一堆人一字排开，同时拿着苹果开吃，谁吃完了就换一个顶替。这样不一会儿苹果就被吃完了。</p></blockquote><p>上面是我一个简单的比喻，希望你可以理解。<br>换到代码上面怎么实现呢？</p><h5 id="使用多线程的例子"><a href="#使用多线程的例子" class="headerlink" title="使用多线程的例子"></a>使用多线程的例子</h5><p>Python里面使用多线程很简单，主要用到threading.Thread<br>来一个小例子</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#FunnySaltyFish 2020/9/16</span></span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FunnyThread</span>(<span class="params">threading.Thread</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,<span class="built_in">id</span></span>):</span></span><br><span class="line">        threading.Thread.__init__(self)</span><br><span class="line">        self.<span class="built_in">id</span> = <span class="built_in">id</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;线程 <span class="subst">&#123;self.<span class="built_in">id</span>&#125;</span> 开始执行&quot;</span>)</span><br><span class="line">        sum_number = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(random.randint(<span class="number">100</span>,<span class="number">10000000</span>)):</span><br><span class="line">            sum_number += i</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;线程 <span class="subst">&#123;self.<span class="built_in">id</span>&#125;</span> 算完了&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    thread1 = FunnyThread(<span class="string">&quot;thread1&quot;</span>)</span><br><span class="line">    thread2 = FunnyThread(<span class="string">&quot;thread2&quot;</span>)</span><br><span class="line">    thread3 = FunnyThread(<span class="string">&quot;thread3&quot;</span>)</span><br><span class="line">    thread1.start()</span><br><span class="line">    thread2.start()</span><br><span class="line">    thread3.start()</span><br></pre></td></tr></table></figure><p>在上面这个例子中，我们定义了一个类继承自Thread，然后重写run方法，该方法就是线程执行时干的事。<br>上述例子中，每个线程会计算一定数量的整数和（吃苹果），具体算多少个数是随机的，以模拟不同线程执行不同耗时任务（也就是吃苹果的速度不一样）<br>运行上述例子，你会得到以下结果：<br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20200916192439951.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTk2MDY3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br><em>（因随机数产生不同，结果以实际运行为准）</em><br>三条线程分别计算三组结果，互不干扰。<br><small>关于多线程，就介绍到这里；有兴趣的话您可以先收藏着本帖，去其他地方深入了解相关知识再回来。这里简单的知识就够用了 </small></p><h5 id="使用Queue"><a href="#使用Queue" class="headerlink" title="使用Queue"></a>使用Queue</h5><p>多线程翻译是可以了，但是怎么知道当前的线程应该去翻译哪个单词了呢？<br>这里我们用到Queue<br>还是拿苹果比喻。</p><blockquote><p>假设有一个竖着的管子，管子的宽度只能容纳单个苹果，且单项开口，你最后放进去的最先拿出来。每个人走到管子前面，伸手抓一个，到旁边吃，换个人再抓一个……直到管子里面没有苹果，结束。</p></blockquote><p>值得注意的是，Python中的Queue是线程安全的，也就是说，即使108个好汉都想同时上梁山，它也能确保梁山一次只被一个好汉上，不会因为多个线程同时访问而冲突。</p><p>放到代码中如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 初始化单词队列</span></span><br><span class="line">words_queue = Queue(<span class="number">7000</span>)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> <span class="keyword">not</span> self.queue.empty():</span><br><span class="line">           cur_word = self.queue.get()</span><br><span class="line">           <span class="built_in">print</span>(<span class="string">f&quot;--&gt;线程 <span class="subst">&#123;self.<span class="built_in">id</span>&#125;</span> 正在翻译 “<span class="subst">&#123;cur_word&#125;</span>” &quot;</span>)</span><br><span class="line">           cur_translation = self.translate(cur_word)</span><br></pre></td></tr></table></figure><h3 id="保存为json"><a href="#保存为json" class="headerlink" title="保存为json"></a>保存为json</h3><p>在保存之前，我们需要确保所有线程都已翻译完毕。<br>使用Thread的join()方法实现。</p><h2 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h2><p>请注意，不像之前的几个教程，这份代码不能直接执行。请对照注释自行修改</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># FunnySaltyFish 2020/9/16</span></span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"><span class="keyword">import</span> xlrd</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> queue <span class="keyword">import</span> Queue</span><br><span class="line"><span class="keyword">from</span> youdao3 <span class="keyword">import</span> YoudaoFanyi</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Crawl_thread</span>(<span class="params">threading.Thread</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, <span class="built_in">id</span>, queue</span>) -&gt; <span class="literal">None</span>:</span></span><br><span class="line">        threading.Thread.__init__(self)</span><br><span class="line">        self.<span class="built_in">id</span> = <span class="built_in">id</span></span><br><span class="line">        self.queue = queue</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;-&gt;启动线程&quot;</span>, self.<span class="built_in">id</span>)</span><br><span class="line">        self.start_crawl()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;-&lt;线程&quot;</span>, self.<span class="built_in">id</span>, <span class="string">&quot;结束&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">start_crawl</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">while</span> <span class="keyword">not</span> self.queue.empty():</span><br><span class="line">            cur_word = self.queue.get()</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;--&gt;线程 <span class="subst">&#123;self.<span class="built_in">id</span>&#125;</span> 正在翻译 “<span class="subst">&#123;cur_word&#125;</span>” &quot;</span>)</span><br><span class="line">            cur_translation = self.translate(cur_word)</span><br><span class="line">            words[cur_word] = cur_translation</span><br><span class="line">            sleep(<span class="number">0.5</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">translate</span>(<span class="params">self, word</span>):</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># 这里用到了一个有道的翻译库</span></span><br><span class="line">        <span class="comment"># 因为涉及到key和id就不放出来了</span></span><br><span class="line">        <span class="comment"># 您可以自行修改这里的翻译代码以体验</span></span><br><span class="line">            <span class="keyword">return</span> youdao.fanyi(word)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;在翻译 <span class="subst">&#123;word&#125;</span> 时出错，错误是 <span class="subst">&#123;e&#125;</span> &quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;错误&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">words = &#123;&#125;</span><br><span class="line">THREAD_NUMS = <span class="number">10</span> <span class="comment"># 线程数目，按需修改</span></span><br><span class="line">youdao = YoudaoFanyi()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    <span class="comment"># 获取原始数据</span></span><br><span class="line">    <span class="comment"># 请自行修改</span></span><br><span class="line">    xls = xlrd.open_workbook(<span class="string">&quot;D:/Downloads/7000hanzi.xlsx&quot;</span>)</span><br><span class="line">    sheet = xls.sheet_by_index(<span class="number">0</span>)</span><br><span class="line">    col = sheet.col_values(<span class="number">1</span>)</span><br><span class="line">    col.pop(<span class="number">0</span>)  <span class="comment"># 剔除表头数据</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 初始化单词队列</span></span><br><span class="line">    words_queue = Queue(<span class="number">7000</span>)</span><br><span class="line">    <span class="keyword">for</span> word <span class="keyword">in</span> col:</span><br><span class="line">        words_queue.put(word)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 初始化爬取线程</span></span><br><span class="line">    crawl_threads = []</span><br><span class="line">    crawl_names = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(THREAD_NUMS):</span><br><span class="line">        crawl_names.append(<span class="string">f&quot;thread-<span class="subst">&#123;i+<span class="number">1</span>&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> name <span class="keyword">in</span> crawl_names:</span><br><span class="line">        thread = Crawl_thread(name, words_queue)</span><br><span class="line">        thread.start()</span><br><span class="line">        crawl_threads.append(thread)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 等待所有线程爬取完成后再执行</span></span><br><span class="line">    <span class="keyword">for</span> t <span class="keyword">in</span> crawl_threads:</span><br><span class="line">        t.join()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;爬取完毕！&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 保存结果</span></span><br><span class="line">    final_text = json.dumps(words)</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;D:\projects\others\words.json&quot;</span>, <span class="string">&quot;w+&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(final_text)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;完成！&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>顺带一提，软件运行起来的效果看起来真的非常爽<br>刷刷刷的~</p><h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><ul><li>我的水平不高，所讲之处难免有所漏洞，还望指正</li><li><a href="/2021/05/26/python-spider-lesson-catalog/">系列文章完整目录</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;多线程批量翻译&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;合理爬取，不恶意扩大站点压力&lt;br&gt;本文章仅作示例，请勿用作非法用途&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h2 id=&quot;效果&quot;&gt;&lt;a href=&quot;#效果&quot; class=&quot;headerlink&quot; title=</summary>
      
    
    
    
    <category term="Python爬虫教程" scheme="https://funnysaltyfish.vercel.app/categories/Python%E7%88%AC%E8%99%AB%E6%95%99%E7%A8%8B/"/>
    
    
    <category term="Python" scheme="https://funnysaltyfish.vercel.app/tags/Python/"/>
    
    <category term="爬虫" scheme="https://funnysaltyfish.vercel.app/tags/%E7%88%AC%E8%99%AB/"/>
    
  </entry>
  
  <entry>
    <title>学了python不知干啥？爬爬虫！ （3）爬取豆瓣书籍列表（bs4/lxml简单使用）</title>
    <link href="https://funnysaltyfish.vercel.app/2021/05/26/python-spider-lesson-3/"/>
    <id>https://funnysaltyfish.vercel.app/2021/05/26/python-spider-lesson-3/</id>
    <published>2021-05-26T08:44:42.000Z</published>
    <updated>2021-06-14T03:40:12.194Z</updated>
    
    <content type="html"><![CDATA[<p>爬取豆瓣书籍列表</p><blockquote><p>合理爬取，不随意扩大站点压力<br>本文章仅作示例，请勿用作非法用途</p></blockquote><hr><h2 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h2><p>&emsp;&emsp;解析豆瓣书籍列表，包括作者/介绍/评分，如下图</p><p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20200710091736191.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTk2MDY3,size_16,color_FFFFFF,t_70#pic_center" alt="效果"></p><h2 id="开始"><a href="#开始" class="headerlink" title="开始"></a>开始</h2><p>&emsp;&emsp;和上文一样，我们先去网页端看看我们准备获取的数据<br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20200710091939466.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTk2MDY3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>&emsp;&emsp;随便点进去一个子分类<br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20200710092001416.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTk2MDY3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>&emsp;&emsp;右键——查看框架源代码 <em>(Edge，其他浏览器请自行对应 )</em><br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20200710092218491.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTk2MDY3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>&emsp;&emsp;哇塞，又是一下子就找到了。<br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9zczAuYmRzdGF0aWMuY29tLzcwY0Z1SFNoX1ExWW54R2twb1dLMUhGNmhoeS9pdC91PTM3MTE3MjEzMzQsMzMxODY1NTMzMiZmbT0yNiZncD0wLmpwZw?x-oss-process=image/format,png#pic_center" alt="在这里插入图片描述"><br>&emsp;&emsp;接下来，开始爬取！</p><h2 id="试爬取"><a href="#试爬取" class="headerlink" title="试爬取"></a>试爬取</h2><p>&emsp;&emsp;根据前几节课的，我们写一版简单的代码试试<br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20200710092515203.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTk2MDY3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>&emsp;&emsp;执行一下！<br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20200710092553166.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTk2MDY3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>&emsp;&emsp;woc！报错！我们来看看这个418是个什么错误</p><blockquote><p>错误描述：经过网上查询得知，418的意思是被网站的反爬程序返回的，网上解释为，418 I’m a teapot<br>The HTTP 418 I’m a teapot client error response code indicates that the server refuses to brew coffee because it is a teapot. This error is a reference to Hyper Text Coffee Pot Control Protocol which was an April Fools’ joke in 1998.<br>翻译为：HTTP 418 I’m a teapot客户端错误响应代码表示服务器拒绝煮咖啡，因为它是一个茶壶。这个错误是对1998年愚人节玩笑的超文本咖啡壶控制协议的引用。</p></blockquote><p>好吧，我们又被bang了，但是没关系，我们有乔装术！</p><h2 id="UA伪装"><a href="#UA伪装" class="headerlink" title="UA伪装"></a>UA伪装</h2><p>&emsp;&emsp;同上节课一样，我们看一下自己的UA<br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20200710092826689.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTk2MDY3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>（顺带一提，在这个过程中，我发现了一个豆瓣很有趣的玩意：<br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20200710092945695.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTk2MDY3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>挺神奇的）<br>&emsp;&emsp;依葫芦画瓢，简单伪装一下：<br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/2020071009313864.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTk2MDY3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>真的是非常的amazing啊，搞定了！</p><h2 id="解析数据"><a href="#解析数据" class="headerlink" title="解析数据"></a>解析数据</h2><p>&emsp;&emsp;有了网页，我们开始解析数据。<br>&emsp;&emsp;前几节课我们一直使用的是纯<strong>正则表达式</strong>，但是既然是学习，我们来整点不一样的</p><h3 id="BeautifulSoup4"><a href="#BeautifulSoup4" class="headerlink" title="BeautifulSoup4"></a>BeautifulSoup4</h3><p>&emsp;&emsp;看到这个题目，你会不会以为我打错了？美丽的汤？这是什么玩意？<br>&emsp;&emsp;事实上我没有打错，bs4是Python爬虫中相当著名的一个包，在解析html时非常易于使用。当然，它也有自己的弊端，例如相较于re，用它解析大量数据速度会慢很多。当然这里并不影响。<br>&emsp;&emsp;如果想学习bs4的话，可以先访问<a href="http://www.jsphp.net/python/show-24-214-1.html">这里</a>，看一下它的基本使用。接下来我们就直接开始。</p><h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><p>使用pip安装</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install beautifulsoup4</span><br></pre></td></tr></table></figure><p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20200710093921939.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTk2MDY3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><h4 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br></pre></td></tr></table></figure><p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/2020071009401278.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTk2MDY3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>&emsp;&emsp;将获取到的html文本作为参数传入，实例化一个BeautifulSoup对象，使用默认的html解析器<br>&emsp;&emsp;然后我们使用<code>find_all</code>方法找到<code>href属性中包含subject的所有标签</code>并且打印试一下<br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20200710094337112.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTk2MDY3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>amazing啊，一下子就找到了所有！<br>如法炮制，我们再找一下其他的</p><p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20200710094738986.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTk2MDY3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>&emsp;&emsp;然而到这里我发现了一个小问题，我们分别提取了 书名、作者、简介，这是这样合在一起似乎不太方便。所以我决定换一种思路，按照豆瓣一本书一本书的爬取，然后再分别提取。<br>&emsp;&emsp;我们来看看它们的一本书对应的代码是怎么写的</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;detail-frame&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;https://book.douban.com/subject/35023731/&quot;</span>&gt;</span>怪诞故事集<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;rating&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;allstar00&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;font-small color-lightgray&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;color-gray&quot;</span>&gt;</span></span><br><span class="line">                        [波兰] 奥尔加·托卡尔丘克 / 浙江文艺出版社 / 2020-7</span><br><span class="line">                    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;detail&quot;</span>&gt;</span></span><br><span class="line">                        诺奖得主奥尔加·托卡尔丘克小说集，讲述了十个怪诞、疯狂、恐怖和幽默的故事，融合了民间传说、童话、科幻、宗教故事等 </span><br><span class="line">元素来观照波兰历史与人的生活。</span><br><span class="line">                    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>&emsp;&emsp;可以看到，每本书都在class=”detail-frame”的div里面。按照这个要求，我们重新爬取全部书籍列表。<br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20200710094844388.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTk2MDY3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>接下来分别解析</p><h3 id="使用lxml"><a href="#使用lxml" class="headerlink" title="使用lxml"></a>使用lxml</h3><p>&emsp;&emsp;对于这样的单独提取出来的&lt;div&gt;&lt;/div&gt;来说，直接用html解析方式怕是不ok了，那我们怎么办？难道又回到写正则的苦逼日子？<br>&emsp;&emsp;不要慌，bs4的解析器除了”html.parser”，还可以直接使用lxml。<br>&emsp;&emsp;什么是lxml？</p><blockquote><p>lxml是python的一个解析库，支持HTML和XML的解析，支持XPath解析方式，而且解析效率非常高。这个库的主要优点是易于使用，在解析大型文档时速度非常快，归档的也非常好，并且提供了简单的转换方法来将数据转换为Python数据类型，从而使文件操作更容易。<br>XPath，全称XML Path Language，即XML路径语言，它是一门在XML文档中查找信息的语言，它最初是用来搜寻XML文档的，但是它同样适用于HTML文档的搜索<br>XPath的选择功能十分强大，它提供了非常简明的路径选择表达式，另外，它还提供了超过100个内建函数，用于字符串、数值、时间的匹配以及节点、序列的处理等，几乎所有我们想要定位的节点，都可以用XPath来选择<br>XPath于1999年11月16日成为W3C标准，它被设计为供XSLT、XPointer以及其他XML解析软件使用，更多的文档可以访问其官方网站：<a href="https://www.w3.org/TR/xpath/">https://www.w3.org/TR/xpath/</a></p></blockquote><p>体验一下？</p><h4 id="安装-1"><a href="#安装-1" class="headerlink" title="安装"></a>安装</h4><p>依旧使用pip安装</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install lxml</span><br></pre></td></tr></table></figure><p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20200710101034281.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTk2MDY3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><h4 id="结合bs4使用"><a href="#结合bs4使用" class="headerlink" title="结合bs4使用"></a>结合bs4使用</h4><ul><li>书籍名在 h2标题下</li><li>作者信息在 class为color-gray的 p标签下</li><li>简介在 class为detail的 p标签下</li></ul><p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20200710101228724.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTk2MDY3,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>&emsp;&emsp;但是很尴尬的是，这样做在执行到后半部分的时候会报错<br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20200710101228674.png" alt="在这里插入图片描述"><br>&emsp;&emsp;原因是有一部分书籍的 简介 直接放在了 p 标签下，而并没有class属性。这也算是一种特殊情况吧（嘤嘤嘤）<br>&emsp;&emsp;没有办法，处理一下特殊情况。完美<br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20200710101736498.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTk2MDY3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><p>&emsp;&emsp;最后闲的蛋疼，我们再把评分补上。大功告成！</p><h2 id="完整源码"><a href="#完整源码" class="headerlink" title="完整源码"></a>完整源码</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#FunnySaltyFish 2020/07/09 完成</span></span><br><span class="line"><span class="comment">#基于Python 3.7.0</span></span><br><span class="line"><span class="keyword">import</span> urllib.request <span class="keyword">as</span> ur</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_html</span>(<span class="params">url</span>):</span></span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.116 Safari/537.36 Edg/83.0.478.61&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    request = ur.Request(url=url, headers=headers)</span><br><span class="line">    html = ur.urlopen(request).read()</span><br><span class="line">    <span class="keyword">return</span> html.decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">parse_html</span>(<span class="params">html</span>):</span></span><br><span class="line">    soup = BeautifulSoup(html, <span class="string">&#x27;html.parser&#x27;</span>)</span><br><span class="line">    <span class="comment"># books_list = soup.find_all(href=re.compile(r&quot;https://book.douban.com/subject/&quot;))</span></span><br><span class="line">    <span class="comment"># authors_list = soup.find_all(class_=re.compile(&quot;color-gray&quot;))</span></span><br><span class="line">    <span class="comment"># details_list = soup.find_all(class_=re.compile(&quot;detail&quot;))</span></span><br><span class="line">    <span class="comment"># print(books_list)</span></span><br><span class="line">    <span class="comment"># print(authors_list)</span></span><br><span class="line">    <span class="comment"># print(details_list)</span></span><br><span class="line">    detail_frames = soup.find_all(class_=re.<span class="built_in">compile</span>(<span class="string">&quot;detail-frame&quot;</span>))</span><br><span class="line">    result_list = []</span><br><span class="line">    <span class="keyword">for</span> each_detail <span class="keyword">in</span> detail_frames:</span><br><span class="line">        result_list.append(parse_one_book(<span class="built_in">str</span>(each_detail)))</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;\n&#x27;</span>.join(result_list)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">parse_one_book</span>(<span class="params">detail</span>):</span></span><br><span class="line">    soup = BeautifulSoup(detail, <span class="string">&#x27;lxml&#x27;</span>)</span><br><span class="line">    name = soup.div.h2.a.string</span><br><span class="line">    author = soup.find(</span><br><span class="line">        <span class="string">&#x27;p&#x27;</span>, attrs=&#123;<span class="string">&#x27;class&#x27;</span>: <span class="string">&#x27;color-gray&#x27;</span>&#125;).string.strip()  <span class="comment"># 去除无效字符</span></span><br><span class="line">    rating = soup.find(</span><br><span class="line">        <span class="string">&#x27;span&#x27;</span>, attrs=&#123;<span class="string">&#x27;class&#x27;</span>: <span class="string">&#x27;font-small color-lightgray&#x27;</span>&#125;).string.strip()</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(<span class="built_in">str</span>(rating)) == <span class="number">0</span>:</span><br><span class="line">        rating = <span class="string">&#x27;暂无评分&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> soup.find(<span class="string">&#x27;p&#x27;</span>, attrs=&#123;<span class="string">&#x27;class&#x27;</span>: <span class="string">&#x27;detail&#x27;</span>&#125;):</span><br><span class="line">        detail = soup.find(</span><br><span class="line">            <span class="string">&#x27;p&#x27;</span>, attrs=&#123;<span class="string">&#x27;class&#x27;</span>: <span class="string">&#x27;detail&#x27;</span>&#125;).string.strip()  <span class="comment"># 去除无效字符</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        detail = soup.find(</span><br><span class="line">            <span class="string">&#x27;p&#x27;</span>, attrs=&#123;<span class="string">&#x27;class&#x27;</span>: <span class="string">&#x27;color-gray&#x27;</span>&#125;).find_next().string.strip()</span><br><span class="line">    result = <span class="string">f&quot;--&gt;%s (%s) 评分：%s:\n   %s&quot;</span> % (name, author, rating, detail)</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    html = get_html(<span class="string">&#x27;https://book.douban.com/latest&#x27;</span>)</span><br><span class="line">    result = parse_html(html)</span><br><span class="line">    <span class="built_in">print</span>(result)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><ul><li>我的水平不高，所讲之处难免有所漏洞，还望指正</li><li><a href="/2021/05/26/python-spider-lesson-catalog/">系列文章完整目录</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;爬取豆瓣书籍列表&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;合理爬取，不随意扩大站点压力&lt;br&gt;本文章仅作示例，请勿用作非法用途&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h2 id=&quot;效果&quot;&gt;&lt;a href=&quot;#效果&quot; class=&quot;headerlink&quot; title</summary>
      
    
    
    
    <category term="Python爬虫教程" scheme="https://funnysaltyfish.vercel.app/categories/Python%E7%88%AC%E8%99%AB%E6%95%99%E7%A8%8B/"/>
    
    
    <category term="Python" scheme="https://funnysaltyfish.vercel.app/tags/Python/"/>
    
    <category term="爬虫" scheme="https://funnysaltyfish.vercel.app/tags/%E7%88%AC%E8%99%AB/"/>
    
  </entry>
  
  <entry>
    <title>学了python不知干啥？爬爬虫！ （2.5）爬取有度小说全本+GUI操作界面 完整代码</title>
    <link href="https://funnysaltyfish.vercel.app/2021/05/26/python-spider-lesson-2-5/"/>
    <id>https://funnysaltyfish.vercel.app/2021/05/26/python-spider-lesson-2-5/</id>
    <published>2021-05-26T08:41:05.000Z</published>
    <updated>2021-10-03T15:19:57.771Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>合理爬取，不随意扩大站点压力<br>本文章仅作示例，请勿用作非法用途</p></blockquote><hr><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>&emsp;&emsp;最近有朋友向我请求帮助，问我可不可以帮忙爬一下有度小说网的   <small>（<em>这不是广告！这不是广告！这不是广告！</em> ）</small>完本小说，刚好有空我就试了一下。于是就有了此篇。<br>&emsp;&emsp;本篇可以算是<a href="https://funnysaltyfish.github.io/2021/05/24/python_spider_lesson_2/">学了python不知干啥？爬爬虫！ （2）爬取网络小说全本并保存</a>的另一个例子吧，所用到的基本思路都是一样的，想知道为什么这么写的朋友可以翻一下那个链接，一点一点分析的。<br>&emsp;&emsp;本篇就不费话了，直接上代码</p><hr><h2 id="库-本身-完整代码"><a href="#库-本身-完整代码" class="headerlink" title="库 本身 完整代码"></a>库 本身 完整代码</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Copyright @FunnySaltyFish</span></span><br><span class="line"><span class="string">    Python 3.7</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> urllib.request <span class="keyword">as</span> ur</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">YouDu</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,start_url,save_path</span>):</span></span><br><span class="line">        self.START_URL = start_url</span><br><span class="line">        self.SAVE_PATH = save_path</span><br><span class="line">        self.BASE_URL = <span class="string">f&quot;https://www.yoduzw.com/&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_html</span>(<span class="params">self,url</span>):</span></span><br><span class="line">        headers = &#123;</span><br><span class="line">            <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.116 Safari/537.36 Edg/83.0.478.61&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">        request = ur.Request(url=url, headers=headers)</span><br><span class="line">        html = ur.urlopen(request).read()</span><br><span class="line">        <span class="keyword">return</span> html.decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">parse_html</span>(<span class="params">self,html</span>):</span></span><br><span class="line">        pattern_content = re.<span class="built_in">compile</span>(<span class="string">r&#x27;&lt;a href=&quot;javascript:&quot; style=&quot;-webkit-tap-highlight-color:rgba\(0,0,0,0\);pointer-events:none;&quot;&gt;(.+)&lt;/p&gt;&lt;/a&gt;&#x27;</span>,re.S)</span><br><span class="line">        content = <span class="built_in">str</span>(re.findall(pattern_content,html)[<span class="number">0</span>])</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;&lt;p style=&quot;font-weight: 400;color:#721f27;&quot;&gt;（本章&#x27;</span> <span class="keyword">in</span> content:</span><br><span class="line">            content = content.replace(<span class="string">&#x27;&lt;p style=&quot;font-weight: 400;color:#721f27;&quot;&gt;（本章&#x27;</span>,<span class="string">&quot;&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;未完）&#x27;</span> <span class="keyword">in</span> content:</span><br><span class="line">            content=content.replace(<span class="string">&#x27;未完）&#x27;</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        content = <span class="built_in">str</span>(content).replace(<span class="string">&quot;&lt;p&gt;&quot;</span>,<span class="string">&quot;  &quot;</span>)</span><br><span class="line">        content = content.replace(<span class="string">&quot;&lt;/p&gt;&quot;</span>,<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">        content = content.strip(<span class="string">&quot;\n\t &quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> content</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">find_next_page</span>(<span class="params">self,html</span>):</span></span><br><span class="line">        pattern_next_page = re.<span class="built_in">compile</span>(<span class="string">r&#x27;var url_next=&quot;(.+?)&quot;&#x27;</span>)</span><br><span class="line">        next_page = <span class="built_in">str</span>(re.findall(pattern_next_page,html)[<span class="number">0</span>])</span><br><span class="line">        <span class="keyword">return</span> next_page</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">find_title</span>(<span class="params">self,html</span>):</span></span><br><span class="line">        pattern_title = re.<span class="built_in">compile</span>(<span class="string">r&#x27;&lt;h1&gt;(.+)&lt;/h1&gt;&#x27;</span>)</span><br><span class="line">        title = <span class="built_in">str</span>(re.findall(pattern_title,html)[<span class="number">0</span>])</span><br><span class="line">        <span class="keyword">return</span> title</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_base_url_num</span>(<span class="params">self</span>):</span></span><br><span class="line">        pattern_base_url = re.<span class="built_in">compile</span>(<span class="string">r&quot;https://www.yoduzw.com/book/(.+)/.+&quot;</span>)</span><br><span class="line">        base_url_num = <span class="built_in">str</span>(re.match(pattern_base_url,self.START_URL).group(<span class="number">1</span>))</span><br><span class="line">        <span class="keyword">return</span> base_url_num</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">createFolders</span>(<span class="params">self, save_path:<span class="built_in">str</span></span>):</span></span><br><span class="line">        parent = os.path.dirname(save_path)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(parent):</span><br><span class="line">            os.makedirs(parent)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self</span>):</span></span><br><span class="line">        url = self.START_URL</span><br><span class="line">        i = <span class="number">1</span></span><br><span class="line">        f = <span class="built_in">open</span>(self.SAVE_PATH, <span class="string">&quot;w+&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="built_in">print</span>(url)</span><br><span class="line">            html = self.get_html(url)</span><br><span class="line">            content = self.parse_html(html)</span><br><span class="line">            next_page_text = self.find_next_page(html)</span><br><span class="line">            title = self.find_title(html)</span><br><span class="line">            text = <span class="string">f&#x27;\n<span class="subst">&#123;title&#125;</span>\n<span class="subst">&#123;content&#125;</span>\n&#x27;</span></span><br><span class="line">            <span class="comment"># print(text)</span></span><br><span class="line">            f.write(text)</span><br><span class="line">            <span class="keyword">if</span> next_page_text != <span class="string">&quot;&quot;</span>:</span><br><span class="line">                url = self.BASE_URL + next_page_text</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                f.close()</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    youdu = YouDu(<span class="string">&quot;https://www.yoduzw.com/book/4869/349727.html&quot;</span>,<span class="string">&quot;D:/Text/明朝那些事儿——1.txt&quot;</span>)</span><br><span class="line">    youdu.get()</span><br></pre></td></tr></table></figure><p>您可以直接修改最下方的网址（必须是有度里面的具体某一章）和保存位置直接运行此代码。<br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20200810152608463.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTk2MDY3,size_16,color_FFFFFF,t_70" alt="控制台输出"></p><p>当然，给别人用不能这么直接给，所以我又简单包装了一下。</p><h2 id="GUI-包装版"><a href="#GUI-包装版" class="headerlink" title="GUI 包装版"></a>GUI 包装版</h2><p>基于tkinter和简单的多线程更新写出了下面这个（丑陋的）GUI 界面<br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20200810152732837.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTk2MDY3,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>运行起来是这样的<br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20200810152849987.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTk2MDY3,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20200810152849988.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTk2MDY3,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>它的代码如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> youdulib</span><br><span class="line"><span class="keyword">from</span> tkinter <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> tkinter <span class="keyword">as</span> tk</span><br><span class="line"><span class="keyword">import</span> tkinter.filedialog <span class="keyword">as</span> tf</span><br><span class="line"><span class="keyword">import</span> tkinter.messagebox <span class="keyword">as</span> tm</span><br><span class="line"><span class="keyword">import</span> tkinter.scrolledtext <span class="keyword">as</span> ts</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> queue</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">SAVE_PATH = <span class="string">&quot;D:/Text&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ReText</span>(<span class="params">queue.Queue</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        queue.Queue.__init__(self)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">write</span>(<span class="params">self, content</span>):</span></span><br><span class="line">        self.put(content)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msg_queue = ReText()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">update_message</span>():</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> msg_queue.empty():</span><br><span class="line">        content = msg_queue.get()</span><br><span class="line">        label_title.insert(tk.END, <span class="string">f&quot;正在爬取：<span class="subst">&#123;content&#125;</span>\n&quot;</span>)</span><br><span class="line">    root.after(<span class="number">100</span>, update_message)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">choose_save_path</span>():</span></span><br><span class="line">    <span class="keyword">global</span> SAVE_PATH</span><br><span class="line">    SAVE_PATH = tf.askdirectory()</span><br><span class="line">    <span class="keyword">if</span>(SAVE_PATH == <span class="string">&quot;&quot;</span>):</span><br><span class="line">        SAVE_PATH = <span class="string">&quot;D:/Text&quot;</span></span><br><span class="line">    var_save_folder.<span class="built_in">set</span>(SAVE_PATH)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">start</span>():</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        youDu = youdulib.YouDu(</span><br><span class="line">            start_url=var_start_url.get(), </span><br><span class="line">            save_path=<span class="string">f&quot;<span class="subst">&#123;var_save_folder.get()&#125;</span>/<span class="subst">&#123;var_save_name.get()&#125;</span>.txt&quot;</span>)</span><br><span class="line">        url = youDu.START_URL</span><br><span class="line">        f = <span class="built_in">open</span>(youDu.SAVE_PATH, <span class="string">&quot;w+&quot;</span>)</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            html = youDu.get_html(url)</span><br><span class="line">            content = youDu.parse_html(html)</span><br><span class="line">            next_page_text = youDu.find_next_page(html)</span><br><span class="line">            title = youDu.find_title(html)</span><br><span class="line">            text = <span class="string">f&#x27;\n<span class="subst">&#123;title&#125;</span>\n  <span class="subst">&#123;content&#125;</span>\n&#x27;</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># 向队列中插入需要更新的内容，以异步更新</span></span><br><span class="line">            msg_queue.write(title)</span><br><span class="line"></span><br><span class="line">            f.write(text)</span><br><span class="line">            <span class="keyword">if</span> next_page_text != <span class="string">&quot;&quot;</span>:</span><br><span class="line">                url = youDu.BASE_URL + next_page_text</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                msg_queue.write(<span class="string">&quot;爬取完成！&quot;</span>)</span><br><span class="line">                f.close()</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        msg_queue.write(<span class="string">&quot;发生错误:&quot;</span>+<span class="built_in">str</span>(e))</span><br><span class="line">        <span class="built_in">print</span>(e.with_traceback())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">command_button_start</span>():</span></span><br><span class="line">    t = threading.Thread(target=start)</span><br><span class="line">    t.start()</span><br><span class="line">    msg_queue.write(<span class="string">&#x27;开始爬取！&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line"></span><br><span class="line">    root = Tk(<span class="string">&quot;YouDu 小说下载&quot;</span>)</span><br><span class="line">    root.geometry(<span class="string">&#x27;600x480&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    var_start_url = StringVar()</span><br><span class="line">    label_url = Label(root, text=<span class="string">&quot;请输入下载小说第一页链接：&quot;</span>)</span><br><span class="line">    label_url.grid(row=<span class="number">0</span>, column=<span class="number">0</span>, sticky=E)</span><br><span class="line">    entry_url = Entry(root, textvariable=var_start_url)</span><br><span class="line">    entry_url.grid(row=<span class="number">0</span>, column=<span class="number">1</span>, columnspan=<span class="number">2</span>, sticky=E+W)</span><br><span class="line"></span><br><span class="line">    label_save_path = Label(root, text=<span class="string">&quot;请选择保存文件夹：&quot;</span>)</span><br><span class="line">    label_save_path.grid(row=<span class="number">1</span>, column=<span class="number">0</span>, sticky=E)</span><br><span class="line">    button_choose_path = Button(root, text=<span class="string">&quot;选择&quot;</span>, command=choose_save_path)</span><br><span class="line">    button_choose_path.grid(row=<span class="number">1</span>, column=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    label_file_name = Label(root, text=<span class="string">&quot;请输入保存后文件名：&quot;</span>)</span><br><span class="line">    label_file_name.grid(row=<span class="number">2</span>, column=<span class="number">0</span>, sticky=E)</span><br><span class="line">    var_save_name = StringVar()</span><br><span class="line">    var_save_folder = StringVar()</span><br><span class="line">    var_save_folder.<span class="built_in">set</span>(SAVE_PATH)</span><br><span class="line">    label_path = Label(root, textvariable=var_save_folder)</span><br><span class="line">    label_path.grid(row=<span class="number">2</span>, column=<span class="number">1</span>, sticky=E)</span><br><span class="line">    entry_file_name = Entry(root, textvariable=var_save_name)</span><br><span class="line">    entry_file_name.grid(row=<span class="number">2</span>, column=<span class="number">2</span>, sticky=E+W)</span><br><span class="line">    button_start = Button(root, text=<span class="string">&quot;开始&quot;</span>, command=command_button_start)</span><br><span class="line">    button_start.grid(row=<span class="number">3</span>, column=<span class="number">0</span>, columnspan=<span class="number">3</span>, sticky=E+W)</span><br><span class="line"></span><br><span class="line">    var_title = StringVar()</span><br><span class="line">    label_title = ts.ScrolledText(root)</span><br><span class="line">    label_title.grid(row=<span class="number">4</span>, column=<span class="number">0</span>, columnspan=<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">    root.after(<span class="number">100</span>, update_message)</span><br><span class="line"></span><br><span class="line">    root.mainloop()</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>撒花！</p><h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><ul><li>我的水平不高，所讲之处难免有所漏洞，还望指正</li><li><strong>因网页结构变动等原因，此项目源码可能无法直接运行，如遇此情况请自行酌情修改！！！</strong></li></ul><h2 id="后续"><a href="#后续" class="headerlink" title="后续"></a>后续</h2><ul><li><a href="/2021/05/26/python-spider-lesson-catalog/">系列文章完整目录</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;合理爬取，不随意扩大站点压力&lt;br&gt;本文章仅作示例，请勿用作非法用途&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h2</summary>
      
    
    
    
    <category term="Python爬虫教程" scheme="https://funnysaltyfish.vercel.app/categories/Python%E7%88%AC%E8%99%AB%E6%95%99%E7%A8%8B/"/>
    
    
    <category term="Python" scheme="https://funnysaltyfish.vercel.app/tags/Python/"/>
    
    <category term="爬虫" scheme="https://funnysaltyfish.vercel.app/tags/%E7%88%AC%E8%99%AB/"/>
    
  </entry>
  
  <entry>
    <title>学了python不知干啥？爬爬虫！ （2）爬取网络小说并保存全本</title>
    <link href="https://funnysaltyfish.vercel.app/2021/05/26/python-spider-lesson-2/"/>
    <id>https://funnysaltyfish.vercel.app/2021/05/26/python-spider-lesson-2/</id>
    <published>2021-05-26T08:01:38.000Z</published>
    <updated>2021-10-03T15:09:33.966Z</updated>
    
    <content type="html"><![CDATA[<p>爬取全本小说并保存到本地！</p><blockquote><p>尊重知识产权，建议阅读原版<br>本文章仅作示例，请勿用作非法用途</p></blockquote><p>该系列的其他篇目：<br><a href="/2021/05/26/python-spider-lesson-catalog/">系列文章完整目录</a></p><hr><h2 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h2><p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20200502125532646.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTk2MDY3,size_16,color_FFFFFF,t_70#pic_center" alt="全本"><br>如你所见，这是一个完整的小说文档。尽管小说原网站并没有提供下载功能，但我们爬虫却做到了！那么，让我们开始吧~</p><h2 id="开始"><a href="#开始" class="headerlink" title="开始"></a>开始</h2><p>这篇小说从哪里来？互联网上。我们不妨先去看看网页端效果是怎样的。<br>打开<a href="https://www.e8zw.com/book/416/416756/2235794.html">这个网页</a>，你就会看到完整的章节列表、广告和广告……<br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20200502130132171.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTk2MDY3,size_16,color_FFFFFF,t_70#pic_center" alt="这广告……"><br>让我们随便打开一章，右键——查看源代码，看看这些东西背后到底是什么。<br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20200502130415342.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTk2MDY3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20200502130433115.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTk2MDY3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>哇，真的是非常的amazing啊，我们居然一下就找到了我们所需要的小说内容！<br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://imgconvert.csdnimg.cn/aHR0cDovL3BpYy45NjIubmV0L3VwLzIwMTgtNi8yMDE4NjIxMDIxOTg3NTk3MC5qcGc?x-oss-process=image/format,png#pic_center" alt="在这里插入图片描述"><br>但是兄弟，我们怎么才能获得这些源码呢？<br>走，我们进入下一步！</p><h2 id="获取网页源码"><a href="#获取网页源码" class="headerlink" title="获取网页源码"></a>获取网页源码</h2><p>上节课 <em>（没看过的请自行查看）</em> 我们讲过，urllib的<code>urlopen</code>函数可以打开一个网页链接，这一次咱们如法炮制，再试一次。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_html</span>(<span class="params">url</span>):</span></span><br><span class="line">    response = ur.urlopen(url)</span><br><span class="line">    html = response.read().decode(<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> html</span><br></pre></td></tr></table></figure><p>然而当你print一下之后，你会发现：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(get_html(URL))</span><br></pre></td></tr></table></figure><p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20200502131611106.png#pic_center" alt="在这里插入图片描述"><br>纳尼？403 Forbidden?服务器把我们拒绝了！<br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pMDJwaWNjZG4uc29nb3VjZG4uY29tLzY5ZjFhNTc3YmQwNGI1NTE?x-oss-process=image/format,png#pic_center" alt="在这里插入图片描述"><br>&emsp;&emsp;没错，有些服务器因为不希望过多的机器访问造成过大的服务器压力，于是会对爬虫采取拒绝访问的措施。你可能就要问了：为什么他会知道我是一只爬虫而不是正常访问呢？<br>&emsp;&emsp;事实上，当访问上述链接时，我们的请求头会有一个<code>User-Agent</code>告诉服务器我们是谁。比如说当我们使用浏览器访问时，就会有如下UA:<br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20200502132405744.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTk2MDY3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>&emsp;&emsp;而当使用urllib时，默认的UA是：<br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20200502132818505.png#pic_center" alt="在这里插入图片描述"><br>&emsp;&emsp;毫无疑问，服务器一看到它，就把我们bang了……<br>&emsp;&emsp;但方法总比问题多，这个UA事实上是完全可以更换的。于是我们改一改：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_html</span>(<span class="params">url</span>):</span></span><br><span class="line">    head = &#123; <span class="comment"># 创造请求头</span></span><br><span class="line">        <span class="string">&quot;Referer&quot;</span>: url,</span><br><span class="line">        <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 6.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/78.0.3904.108 Safari/537.36&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    request = ur.Request(url, headers=head)<span class="comment"># 新建一个request，使用我们构造好的head</span></span><br><span class="line">    response = ur.urlopen(request)<span class="comment"># 访问</span></span><br><span class="line">    html = response.read().decode(<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> html</span><br></pre></td></tr></table></figure><p>&emsp;&emsp;你是否发现了一个问题：这一次我们的urlopen改为了打开request而不是url直链。我们来看看文档是怎么说的：</p><blockquote><p>urlopen(url, data=None, timeout=&lt;object object at 0x00634920&gt;, *, cafile=None, capath=None, cadefault=False, context=None)<br>Open the URL url, which can be either a string or a Request object.</p></blockquote><p>&emsp;&emsp;事实上，当你使用字符串作为参数时，python会自动帮你利用url和默认的数据构造一个Request再完成访问。<br>&emsp;&emsp;那么结果如何呢？我们再跑一次：<br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/2020050213395433.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTk2MDY3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>当当当当！搞定~</p><h2 id="提取内容"><a href="#提取内容" class="headerlink" title="提取内容"></a>提取内容</h2><p>&emsp;&emsp;有了网页，提取内容就不是什么问题了。通过观察我们可以知道，所有小说内容包裹在&lt;div id=”content”&gt;后面。于是，利用正则表达式 <em>【正则表达式是一种根据特定规则提取文本的技术，您可以先学习之后再回到本章节观看】</em> ，我们可以写出如下代码：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">re_content = re.<span class="built_in">compile</span>(<span class="string">r&#x27;&#x27;&#x27;并刷新页面。&lt;/div&gt;.\s+(.+?)&lt;script language=&quot;javascript&quot; type=&quot;text/javascript&quot; src=&quot;https://mgzs.cdn.bcebos.com/txt.js&quot;&gt;&#x27;&#x27;&#x27;</span>, re.S)</span><br><span class="line">content = re.findall(re_content, html)[<span class="number">0</span>]</span><br></pre></td></tr></table></figure><p>&emsp;&emsp;再处理一下特殊字符，让文本好看一点，我们最终得到了这样一个函数：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_base_content</span>(<span class="params">html</span>):</span></span><br><span class="line">    re_content = re.<span class="built_in">compile</span>(<span class="string">r&#x27;&#x27;&#x27;并刷新页面。&lt;/div&gt;.\s+(.+?)&lt;script language=&quot;javascript&quot; type=&quot;text/javascript&quot; src=&quot;https://mgzs.cdn.bcebos.com/txt.js&quot;&gt;&#x27;&#x27;&#x27;</span>, re.S)</span><br><span class="line">    content = re.findall(re_content, html)[<span class="number">0</span>]</span><br><span class="line">    content = content.replace(<span class="string">&quot;&lt;br /&gt;&quot;</span>, <span class="string">&quot;\n&quot;</span>)</span><br><span class="line">    content = content.replace(<span class="string">&quot;　　&amp;nbsp;\n&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> content</span><br></pre></td></tr></table></figure><p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20200502134734320.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTk2MDY3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>完美！</p><h2 id="获取标题"><a href="#获取标题" class="headerlink" title="获取标题"></a>获取标题</h2><p>&emsp;&emsp;如法炮制，我们把标题也取一下，看着好看一点：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_title</span>(<span class="params">html</span>):</span></span><br><span class="line">    re_title = re.<span class="built_in">compile</span>(<span class="string">r&#x27;&lt;h1 class=&quot;title&quot;&gt;(.+?)&lt;/h1&gt;&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> re.search(re_title, html).group(<span class="number">1</span>)</span><br></pre></td></tr></table></figure><p>&emsp;&emsp;这样就完成了一章内容的获取。</p><h2 id="批量爬取"><a href="#批量爬取" class="headerlink" title="批量爬取"></a>批量爬取</h2><p>&emsp;&emsp;爬完了一章，批量爬取就很简单了。<br>&emsp;&emsp;观察源代码，我们可以看到所有的下一章链接都被明显标出<br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20200502135138654.png#pic_center" alt="网页处理"><br>&emsp;&emsp;所以事实上，我们要做的就是：</p><div class="mermaid">graph TB    Start[&#x2F;开始&#x2F;]--&gt;A([获取一章标题]);    B([获取一章内容]);    A--&gt;B;    C{是否有下一章};    B--&gt;C;    C--是--&gt;A;    C--否--&gt;End[&#x2F;结束&#x2F;];</div><p>那么如何判断是不是最后一章呢？我们看一下网页是怎么处理的：<br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20200502140043524.png#pic_center" alt="网页处理"><br>&emsp;&emsp;可以看到，网页版对于最后一张的处理是回到主页。所以我们只需要判断获取到的下一页url是不是一个  ./ 就可以确定了。<br>&emsp;&emsp;上述完整代码如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">BASE_URL = <span class="string">&quot;https://www.e8zw.com/&quot;</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_next_page</span>(<span class="params">html</span>):</span></span><br><span class="line">    re_next_page = re.<span class="built_in">compile</span>(<span class="string">r&#x27;&lt;a href=&quot;(.+?)&quot;&gt;下一[章|页]&lt;/a&gt;&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> BASE_URL + re.search(re_next_page, html).group(<span class="number">1</span>)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># print(get_base_content(get_html(URL)))</span></span><br><span class="line">    html = <span class="string">&quot;&quot;</span></span><br><span class="line">    url = URL</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        html = get_html(url)</span><br><span class="line">        text = get_base_content(html)</span><br><span class="line">        title = get_title(html)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;title&#125;</span>\n<span class="subst">&#123;text&#125;</span>&quot;</span>)</span><br><span class="line">        url = get_next_page(html)</span><br></pre></td></tr></table></figure><h2 id="保存为文本"><a href="#保存为文本" class="headerlink" title="保存为文本"></a>保存为文本</h2><p>读取之后，利用简单的文件操作即可保存啦！<br>完成，撒花！！！</p><h2 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> urllib.request <span class="keyword">as</span> ur</span><br><span class="line">BASE_URL = <span class="string">&quot;https://www.e8zw.com/&quot;</span></span><br><span class="line">URL = <span class="string">&quot;https://www.e8zw.com/book/416/416756/2235794.html&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_html</span>(<span class="params">url</span>):</span></span><br><span class="line">    head = &#123;  <span class="comment"># 创造请求头</span></span><br><span class="line">        <span class="string">&quot;Referer&quot;</span>: url,</span><br><span class="line">        <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 6.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/78.0.3904.108 Safari/537.36&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    request = ur.Request(url, headers=head)  <span class="comment"># 新建一个request，使用我们构造好的head</span></span><br><span class="line">    response = ur.urlopen(request)  <span class="comment"># 访问</span></span><br><span class="line">    html = response.read().decode(<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> html</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_base_content</span>(<span class="params">html</span>):</span></span><br><span class="line">    re_content = re.<span class="built_in">compile</span>(<span class="string">r&#x27;&#x27;&#x27;并刷新页面。&lt;/div&gt;.\s+(.+?)&lt;script language=&quot;javascript&quot; type=&quot;text/javascript&quot; src=&quot;https://mgzs.cdn.bcebos.com/txt.js&quot;&gt;&#x27;&#x27;&#x27;</span>, re.S)</span><br><span class="line">    content = re.findall(re_content, html)[<span class="number">0</span>]</span><br><span class="line">    content = content.replace(<span class="string">&quot;&lt;br /&gt;&quot;</span>, <span class="string">&quot;\n&quot;</span>)</span><br><span class="line">    content = content.replace(<span class="string">&quot;　　&amp;nbsp;\n&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> content</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_next_page</span>(<span class="params">html</span>):</span></span><br><span class="line">    re_next_page = re.<span class="built_in">compile</span>(<span class="string">r&#x27;&lt;a href=&quot;(.+?)&quot;&gt;下一[章|页]&lt;/a&gt;&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> BASE_URL + re.search(re_next_page, html).group(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_title</span>(<span class="params">html</span>):</span></span><br><span class="line">    re_title = re.<span class="built_in">compile</span>(<span class="string">r&#x27;&lt;h1 class=&quot;title&quot;&gt;(.+?)&lt;/h1&gt;&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> re.search(re_title, html).group(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    html = <span class="string">&quot;&quot;</span></span><br><span class="line">    url = URL</span><br><span class="line">    <span class="comment"># 保存的文件路径，请修改为你自己的路径</span></span><br><span class="line">    f = <span class="built_in">open</span>(<span class="string">&quot;D:/projects/something_download/神澜奇遇——海龙珠.txt&quot;</span>, <span class="string">&quot;w+&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="comment"># 获取每一章html源码</span></span><br><span class="line">        html = get_html(url)</span><br><span class="line">        <span class="comment"># 获取内容</span></span><br><span class="line">        text = get_base_content(html)</span><br><span class="line">        <span class="comment"># 获取标题</span></span><br><span class="line">        title = get_title(html)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;title&#125;</span>\n<span class="subst">&#123;text&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="comment"># 获取下一页的链接</span></span><br><span class="line">        url = get_next_page(html)</span><br><span class="line">        f.write(<span class="string">f&quot;<span class="subst">&#123;title&#125;</span><span class="subst">&#123;text&#125;</span>\n\n&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> url.endswith(<span class="string">&quot;./&quot;</span>):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;全本写入完毕！&quot;</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    f.close()</span><br></pre></td></tr></table></figure><h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><ul><li>你可以试着用这样的方法保存其他小说，然后不出意外，有些地方的小说你一定会遇到问题（譬如访问不了，网页中没有内容等等）。我们之后再扯</li><li><strong>因网页结构变动等原因，此项目源码可能无法直接运行，如遇此情况请自行酌情修改！！！</strong></li></ul><h2 id="后续"><a href="#后续" class="headerlink" title="后续"></a>后续</h2><ul><li><a href="/2021/05/26/python-spider-lesson-catalog/">系列文章完整目录</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;爬取全本小说并保存到本地！&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;尊重知识产权，建议阅读原版&lt;br&gt;本文章仅作示例，请勿用作非法用途&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;该系列的其他篇目：&lt;br&gt;&lt;a href=&quot;/2021/05/26/python-spider-</summary>
      
    
    
    
    <category term="Python爬虫教程" scheme="https://funnysaltyfish.vercel.app/categories/Python%E7%88%AC%E8%99%AB%E6%95%99%E7%A8%8B/"/>
    
    
    <category term="Python" scheme="https://funnysaltyfish.vercel.app/tags/Python/"/>
    
    <category term="爬虫" scheme="https://funnysaltyfish.vercel.app/tags/%E7%88%AC%E8%99%AB/"/>
    
  </entry>
  
  <entry>
    <title>学了python不知干啥？爬爬虫！（1）爬取网络图片</title>
    <link href="https://funnysaltyfish.vercel.app/2021/05/26/python-spider-lesson-1/"/>
    <id>https://funnysaltyfish.vercel.app/2021/05/26/python-spider-lesson-1/</id>
    <published>2021-05-26T00:00:00.000Z</published>
    <updated>2021-06-14T03:37:10.423Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>生活就像淋浴：方向转错，水深火热 ——意林</p></blockquote><h2 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h2><hr><p>各位玩python的，相比对“爬虫”这个字眼并不陌生。啥？你不知道？对啦，就是需要一个不知道的……</p><p>那么，咱们的第一件事就是……  </p><hr><h2 id="概念"><a href="#概念" class="headerlink" title="概念"></a><del>概念</del></h2><p>上来一手概念，恐怕这是<strong>最劝退</strong>的了<br>咱们还是先来看看它能干啥吧</p><hr><h2 id="这只虫，能干嘛？"><a href="#这只虫，能干嘛？" class="headerlink" title="这只虫，能干嘛？"></a>这只虫，能干嘛？</h2><ul><li><p>不打开网页，下载图片啦<br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20191228232539627.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTk2MDY3,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p></li><li><p>不打开网页，看看小说啦<br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/2019122823221987.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTk2MDY3,size_16,color_FFFFFF,t_70" alt="看小说"></p></li><li><p>或者保存点贴吧贴子啦，图片啦<br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20191228232308841.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTk2MDY3,size_16,color_FFFFFF,t_70" alt="百度贴吧"></p></li><li><p>等等……</p><p>什么，你说：那我要这玩意儿干嘛？我打开网页不是更快吗？<br>同志，男人不能一味追求快……不对，是有些事情你打开网页也不好干……<br>例如：</p></li><li><p>获取某乎所有用户年龄组成、性别比例（诶？怎么有点像生物）</p></li><li><p>获取某地区程序员平均工资</p></li><li><p>…<br>但是，这些，<strong>爬虫都可以干！</strong><br>那么，让我们愉快的开始吧！</p></li></ul><hr><h2 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h2><p>author：FunnySaltyFish<br>python：3.6<br>win7 x86</p><hr><h2 id="搞张图片"><a href="#搞张图片" class="headerlink" title="搞张图片"></a>搞张图片</h2><p>首先，让我们打开百度图片，这样搜索:<br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20191228233355354.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTk2MDY3,size_16,color_FFFFFF,t_70" alt="搜索"><br>然后在你看到的这张可爱的图片上，单击右键——复制图片地址<br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20191228233456609.png#pic_center" alt="在这里插入图片描述"><br><em>（此处使用的是360毒瘤浏览器，是的没错，360。不推荐你使用这玩意儿。其他浏览器应该也有此功能，找到类似的就好）</em><br><em>（如果你是手机编程党，比如我，推荐使用via。这款0.5M的浏览器却十分强大，包括了后面的教程中我们要使用到的网页源码查看和网页调试【安装插件的情况下】）</em><br>接下来，我们肝代码！</p><h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><p>直接上！</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.request <span class="keyword">as</span> ur</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">save_pic</span>():</span></span><br><span class="line">    <span class="comment">#打开网页</span></span><br><span class="line">    url = <span class="string">&#x27;https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=95902427,199603518&amp;fm=26&amp;gp=0.jpg&#x27;</span></span><br><span class="line">    <span class="comment">#读取</span></span><br><span class="line">    html=ur.urlopen(url).read()</span><br><span class="line">    <span class="comment">#print(html)</span></span><br><span class="line">    <span class="comment">#以二进制保存</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;D:\projects\something_download\pic.jpg&quot;</span>,<span class="string">&#x27;wb+&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(html)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    save_pic()</span><br></pre></td></tr></table></figure><p>短？没错，就是这么短！<br>我们来看看这个代码干了些什么</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.request <span class="keyword">as</span> ur</span><br></pre></td></tr></table></figure><p>1.很明显，这玩意就是一个导库</p><blockquote><p>urllib是Python自带的标准库，无需安装，直接可以使用。<br>提供了如下功能：<br>-网页请求<br>-响应获取<br>-代理和cookie设置<br>-异常处理<br>-URL解析</p></blockquote><p>简而言之，这是python官方提供的简单易上手但功能强大的库<br>至于它的功能，嘿嘿，我们就先不多扯了，后面再慢慢看。先往下看</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#打开网页</span></span><br><span class="line">url = <span class="string">&#x27;https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=95902427,199603518&amp;fm=26&amp;gp=0.jpg&#x27;</span></span><br><span class="line"><span class="comment">#读取</span></span><br><span class="line">html=ur.urlopen(url).read()</span><br></pre></td></tr></table></figure><p>此处的url就是刚刚复制的图片地址，而后面的urlopen就是打开这个url啦<br>它的用法如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">urlopen(url, data, timeout)   </span><br><span class="line"><span class="comment">#第一个参数url即为需要打开的URL，为必选项。</span></span><br><span class="line"><span class="comment">#第二个参数data默认状态为空，先不管它</span></span><br><span class="line"><span class="comment">#第三个timeout是设置超时时间，默认为socket._GLOBAL_DEFAULT_TIMEOUT。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#执行 urlopen 方法之后，返回一个response对象。返回信息便保存在这里面。</span></span><br></pre></td></tr></table></figure><p>通过read()可以读取到里面的内容 <em>（读者也可以试试不加read直接打印会输出什么）</em><br>由于我们获得的链接是图片直链，此处返会的便直接是图片的原始编码。接下来，只需保存就好啦！</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#以二进制保存</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;D:\projects\something_download\pic.jpg&quot;</span>,<span class="string">&#x27;wb+&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(html)</span><br></pre></td></tr></table></figure><p>执行后，相应文件夹即会出现对应图片  </p><hr><h4 id="有点麻烦，换个方法？"><a href="#有点麻烦，换个方法？" class="headerlink" title="有点麻烦，换个方法？"></a>有点麻烦，换个方法？</h4><p>其实，如果单单保存一张图片的话，urllib为我们提供好了一个方法<br>我们来试一下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">save_pic2</span>():</span></span><br><span class="line">    url = <span class="string">&#x27;https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=95902427,199603518&amp;fm=26&amp;gp=0.jpg&#x27;</span></span><br><span class="line">    ur.urlretrieve(url,<span class="string">&quot;D:\projects\something_download\pic2.jpg&quot;</span>)</span><br></pre></td></tr></table></figure><p>运行结果和刚刚相同</p><blockquote><p>urllib模块提供的urlretrieve()函数。urlretrieve()方法直接将远程数据下载到本地。</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">urlretrieve(url, filename=<span class="literal">None</span>, reporthook=<span class="literal">None</span>, data=<span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#参数filename指定了保存本地路径（如果参数未指定，urllib会生成一个临时文件保存数据。）</span></span><br><span class="line"><span class="comment">#参数reporthook是一个回调函数，当连接上服务器、以及相应的数据块传输完毕时会触发该回调，我们可以利用这个回调函数来显示当前的下载进度。</span></span><br><span class="line"><span class="comment">#参数data指post导服务器的数据，该方法返回一个包含两个元素的(filename, headers) 元组，filename 表示保存到本地的路径，header表示服务器的响应头</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#懒得打字了，这里来源：https://blog.csdn.net/fengzhizi76506/article/details/59229846</span></span><br><span class="line"><span class="comment">#倾删</span></span><br></pre></td></tr></table></figure><p>好啦，我们的小虫虫就下载完成了！  </p><hr><h2 id="所以，爬虫是啥"><a href="#所以，爬虫是啥" class="headerlink" title="所以，爬虫是啥"></a>所以，爬虫是啥</h2><p>如果让现在的我们概括这个问题，我们应该可以这样想象：</p><ul><li>互联网是一张大网（它也确实很大），爬虫就是上面的一只只蜘蛛，沿着网的触须蔓延开来，在互联网上搜索的我们感兴趣的资源（比如这张图片），然后按照我们的意愿对它进行一定操作（如我们的保存）。爬取、数据处理、保存等操作便完成了一次爬取。</li><li>事实上，搜索引擎就是一个巨大的爬虫，它通过一定的方法遍历搜索范围内的所有节点（如你喜欢看片……片子，你可能就会走遍你附近的所有影院），并将它们按一定的索引（比如你的口味）建成一个巨大的数据库（比如记在小本本上）。然后，当用户需要搜索需求（比如你饥渴了）时，就可以按照这个索引（如你编好的小本本）用特定的方法找到对应的资源。</li><li>（实际上，网络爬虫的概念并不那么简单，感兴趣的可以阅读<a href="https://baike.baidu.com/item/%E7%BD%91%E7%BB%9C%E7%88%AC%E8%99%AB/5162711">这里</a>看一看）*</li></ul><h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><ul><li>你可以试着用这样的方法保存其他图片，然后不出意外，有些地方的图片你一定会遇到问题。我们之后再扯</li><li>爬虫的应用场景很广泛，绝对不止保存图片。下一次，我们将尝试读取网页进行操作，敬请期待</li><li>我的水平不高，所讲之处难免有所漏洞，还望指正</li></ul><h2 id="后续"><a href="#后续" class="headerlink" title="后续"></a>后续</h2><ul><li><a href="/2021/05/26/python-spider-lesson-catalog/">系列文章完整目录</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;生活就像淋浴：方向转错，水深火热 ——意林&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;引言&quot;&gt;&lt;a href=&quot;#引言&quot; class=&quot;headerlink&quot; title=&quot;引言&quot;&gt;&lt;/a&gt;引言&lt;/h2&gt;&lt;hr&gt;
&lt;p&gt;各位玩python</summary>
      
    
    
    
    <category term="Python爬虫教程" scheme="https://funnysaltyfish.vercel.app/categories/Python%E7%88%AC%E8%99%AB%E6%95%99%E7%A8%8B/"/>
    
    
    <category term="Python" scheme="https://funnysaltyfish.vercel.app/tags/Python/"/>
    
    <category term="爬虫" scheme="https://funnysaltyfish.vercel.app/tags/%E7%88%AC%E8%99%AB/"/>
    
  </entry>
  
  <entry>
    <title>学了python不知干啥？爬爬虫！目录</title>
    <link href="https://funnysaltyfish.vercel.app/2021/05/26/python-spider-lesson-catalog/"/>
    <id>https://funnysaltyfish.vercel.app/2021/05/26/python-spider-lesson-catalog/</id>
    <published>2021-05-25T23:00:00.000Z</published>
    <updated>2021-06-14T03:35:42.653Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>合理爬取，不恶意扩大站点压力<br>本文章仅作示例，请勿用作非法用途</p></blockquote><p>该系列的其他篇目：</p><ol><li><a href="/2021/05/26/python-spider-lesson-1/">（1）保存网络图片</a></li><li><a href="/2021/05/26/python-spider-lesson-2/">（2）爬取网络小说全本并保存</a></li><li><a href="/2021/05/26/python-spider-lesson-2-5/">（2.5）另一个网络小说例子+GUI操作界面 </a></li><li><a href="/2021/05/26/python-spider-lesson-3/">（3）爬取豆瓣书籍列表（bs4/lxml简单使用）</a></li><li><a href="/2021/05/26/python-spider-lesson-4/">（4）多线程爬取</a></li><li><a href="/2021/05/26/python-spider-lesson-5/">（5）requests+错误处理</a></li><li><a href="/2021/05/26/python-spider-lesson-6/">（6）爱词霸翻译【js逆向，全过程详解】</a></li><li><a href="/2021/05/26/python-spider-lesson-7/">（7）代理的概念和使用</a></li></ol><p>其他</p><ul><li>我的<a href="https://github.com/FunnySaltyFish">github</a></li><li>我的<a href="https://gitee.com/FunnySaltyFish">gitee</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;合理爬取，不恶意扩大站点压力&lt;br&gt;本文章仅作示例，请勿用作非法用途&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;该系列的其他篇目：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;/2021/05/26/python-spider-lesson-1/&quot;</summary>
      
    
    
    
    <category term="Python爬虫教程" scheme="https://funnysaltyfish.vercel.app/categories/Python%E7%88%AC%E8%99%AB%E6%95%99%E7%A8%8B/"/>
    
    
    <category term="Python" scheme="https://funnysaltyfish.vercel.app/tags/Python/"/>
    
    <category term="爬虫" scheme="https://funnysaltyfish.vercel.app/tags/%E7%88%AC%E8%99%AB/"/>
    
  </entry>
  
  <entry>
    <title>关于我</title>
    <link href="https://funnysaltyfish.vercel.app/2021/05/23/about-me/"/>
    <id>https://funnysaltyfish.vercel.app/2021/05/23/about-me/</id>
    <published>2021-05-23T00:00:00.000Z</published>
    <updated>2021-06-02T02:35:37.387Z</updated>
    
    <content type="html"><![CDATA[<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>个人开发者，混迹于<a href="http://www.coolapk.com/u/1951593">酷安</a> <code>@FunnySaltyFish</code></p><hr><h2 id="作品"><a href="#作品" class="headerlink" title="作品:"></a>作品:</h2><h3 id="Android应用"><a href="#Android应用" class="headerlink" title="Android应用"></a>Android应用</h3><ul><li><a href="https://www.coolapk.com/apk/com.funny.translation">FunnyTranslation</a>——一对多翻译软件，零广告、全免费、少权限</li></ul><h3 id="开源库"><a href="#开源库" class="headerlink" title="开源库"></a>开源库</h3><ul><li><a href="https://github.com/FunnySaltyFish/FunnyBottomNavigation">FunnyBottomNavigation</a>——基于Kotlin实现的Android底部导航栏，具有漂亮的过渡动画，易于使用</li><li><a href="https://github.com/FunnySaltyFish/FunnyTimeLine">FunnyTimeLine</a>——自定义View实现的时间轴，带有三阶惯性滑动</li></ul><h3 id="持续开发中……"><a href="#持续开发中……" class="headerlink" title="持续开发中……"></a>持续开发中……</h3>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;简介&quot;&gt;&lt;a href=&quot;#简介&quot; class=&quot;headerlink&quot; title=&quot;简介&quot;&gt;&lt;/a&gt;简介&lt;/h2&gt;&lt;p&gt;个人开发者，混迹于&lt;a href=&quot;http://www.coolapk.com/u/1951593&quot;&gt;酷安&lt;/a&gt; &lt;code&gt;@Funn</summary>
      
    
    
    
    
  </entry>
  
</feed>
